<!-- Show All tags -->
<!-- Sort tags by number of posts
	Sorting is done by creating sortable strings which have the counts prepended.
	- Counts are separated from tags with ":::"
	- Sortable tag-counts are seperated with "###"
	- `site.tags` is a hashmap from tag to list of posts, use `size` to get number of posts.
-->

{% capture count_tags_splittable_str %}
{% for tag in site.tags %}
    {{ tag | last | size | prepend:"000000" | slice:-6,6 }}:::{{ tag | first }}
    {% unless forloop.last %}###{% endunless %}
{% endfor %}
{% endcapture %}
{% assign counts_and_tags_sorted = count_tags_splittable_str | split:"###" | sort | reverse %}

{% for count_and_tag in counts_and_tags_sorted %}
    {% assign tag = count_and_tag | split:":::" | last | strip %}
    {% assign count = 0 %}

    {% assign models = false %}

    {% for post in site.tags[tag] %}
      {% if post.folder == 'models' %}
        {% assign models = true %}
        {% capture count %}{{ count | plus:1 }}{% endcapture %}
      {% endif %}
    {% endfor %}

    {% if models == true %}
      <a href="#{{ tag | slugify }}" class="btn btn-outline-primary tag-btn">
          <span class="fa fa-tag" aria-hidden="true"></span> {{ tag }} ({{ count }})
      </a>
    {% endif %}
{% endfor %}
<hr>

<!-- Show tags alphabetically by character -->
{% capture _site_tags %}{% for tag in site.tags %}{{ tag | first }}{% unless forloop.last %}###{% endunless %}{% endfor %}{% endcapture %}
{% assign tags_alphabetically_sorted = _site_tags | split:'###' | sort %}

<!-- Divide tags into pages according to their first character -->
<div class="pagination-container">
  <!-- Create pages for each character -->
  {% assign prev_char = "#" %}
  {% for sorted_tag in tags_alphabetically_sorted %}
    {% assign tag = sorted_tag | strip %}
    
    {% assign current_char = tag | slice: 0 %}
    {% if current_char != prev_char %}
      <!-- Create tag pages for current character -->
      {% assign prev_char = current_char %}
      <!-- Close previous div -->
      {% unless forloop.first %}</div>{% endunless %}
      <!-- Create new tag page, hide by default -->
        <div class="page-content" page-idx="{{ current_char }}" style="display:none;">
        <h4><span class="fas fa-tags fa-fw"></span> Tags starting with {{ current_char }}:</h4>
    {% endif %}
    
    <!-- Display Tags starting with current character -->
      <h5 id="{{ tag | slugify}}">
        <span class="fas fa-tag" aria-hidden="true"></span> {{ tag }}:
        <a class="anchor-link" href="#{{ tag | slugify}}"><i class="fas fa-sm fa-link"></i></a>
      </h5>
      <ul>
        {% for post in site.tags[tag] %}
          {% if post.folder == 'models' %}
          <li>
            <a href="{{ post.url }}">{{ post.title }}</a>
            <br>
            <i>{{ post.date | date_to_string }}</i>
            <br>
            {{ post.description }}
          {% endif %}
        {% endfor %}
      </ul>

    <hr>
    <!-- End last page -->
    {% if forloop.last %}</div>{% endif %}
  {% endfor %}

  <!-- Page navigation -->
  <nav aria-label="Tags Alphabetic Pagination">
      <ul class="pagination justify-content-center">
        {% assign prev_char = "#" %}
        {% for tag in tags_alphabetically_sorted %}

          {% assign models = false %}
          {% for post in site.tags[tag] %}
            {% if post.folder == 'models' %}
              {% assign models = true %}
            {% endif %}
          {% endfor %}
          {% if models == true %}
            {% assign current_char = tag | slice: 0 %}
            {% if current_char != prev_char %}
              {% assign prev_char = current_char %}
              <li class="page-item" page-idx="{{ current_char }}">
                <a class="page-link" href="#" >
                  {{ current_char }}
                </a>
              </li>
            {% endif %}
          {% endif %}
        {% endfor %}
    </ul>
  </nav>

</div>
<hr>

<script src="{{ site.baseurl }}/assets/js/tag_pages.js"></script>