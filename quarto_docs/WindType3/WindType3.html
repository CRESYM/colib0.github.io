<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.55">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Martin Franke (Fraunhofer IEE), Luka Plavec (Fraunhofer IEE)">

<title>IEC Wind Turbine Type 3 (Doubly-Fed Induction Generator)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="WindType3_files/libs/clipboard/clipboard.min.js"></script>
<script src="WindType3_files/libs/quarto-html/quarto.js"></script>
<script src="WindType3_files/libs/quarto-html/popper.min.js"></script>
<script src="WindType3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="WindType3_files/libs/quarto-html/anchor.min.js"></script>
<link href="WindType3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="WindType3_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="WindType3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="WindType3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="WindType3_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#acronyms_HEADER_LOA" id="toc-acronyms_HEADER_LOA" class="nav-link active" data-scroll-target="#acronyms_HEADER_LOA"><span class="header-section-number">1</span> List Of Acronyms</a></li>
  <li><a href="#context" id="toc-context" class="nav-link" data-scroll-target="#context"><span class="header-section-number">2</span> Context</a></li>
  <li><a href="#model-use-assumptions-validity-domain-and-limitations" id="toc-model-use-assumptions-validity-domain-and-limitations" class="nav-link" data-scroll-target="#model-use-assumptions-validity-domain-and-limitations"><span class="header-section-number">3</span> Model use, assumptions, validity domain and limitations</a></li>
  <li><a href="#wind-turbine-type-3" id="toc-wind-turbine-type-3" class="nav-link" data-scroll-target="#wind-turbine-type-3"><span class="header-section-number">4</span> Wind turbine type 3</a>
  <ul class="collapse">
  <li><a href="#sec-wt-p-control" id="toc-sec-wt-p-control" class="nav-link" data-scroll-target="#sec-wt-p-control"><span class="header-section-number">4.1</span> P control module</a>
  <ul class="collapse">
  <li><a href="#sec-torque-pi" id="toc-sec-torque-pi" class="nav-link" data-scroll-target="#sec-torque-pi"><span class="header-section-number">4.1.1</span> Torque PI block</a></li>
  <li><a href="#variable-limits-integrator-with-setreset-and-freeze" id="toc-variable-limits-integrator-with-setreset-and-freeze" class="nav-link" data-scroll-target="#variable-limits-integrator-with-setreset-and-freeze"><span class="header-section-number">4.1.2</span> Variable limits integrator with set/reset and freeze</a></li>
  <li><a href="#sec-wt-p-params" id="toc-sec-wt-p-params" class="nav-link" data-scroll-target="#sec-wt-p-params"><span class="header-section-number">4.1.3</span> Parameters</a></li>
  <li><a href="#variables" id="toc-variables" class="nav-link" data-scroll-target="#variables"><span class="header-section-number">4.1.4</span> Variables</a></li>
  <li><a href="#equations-algorithm" id="toc-equations-algorithm" class="nav-link" data-scroll-target="#equations-algorithm"><span class="header-section-number">4.1.5</span> Equations &amp; algorithm &nbsp;</a></li>
  <li><a href="#initial-equations" id="toc-initial-equations" class="nav-link" data-scroll-target="#initial-equations"><span class="header-section-number">4.1.6</span> Initial equations</a></li>
  </ul></li>
  <li><a href="#q-control-module" id="toc-q-control-module" class="nav-link" data-scroll-target="#q-control-module"><span class="header-section-number">4.2</span> Q control module</a>
  <ul class="collapse">
  <li><a href="#parameters" id="toc-parameters" class="nav-link" data-scroll-target="#parameters"><span class="header-section-number">4.2.1</span> Parameters</a></li>
  <li><a href="#variables-1" id="toc-variables-1" class="nav-link" data-scroll-target="#variables-1"><span class="header-section-number">4.2.2</span> Variables:</a></li>
  <li><a href="#initial-equations-1" id="toc-initial-equations-1" class="nav-link" data-scroll-target="#initial-equations-1"><span class="header-section-number">4.2.3</span> Initial equations</a></li>
  </ul></li>
  <li><a href="#q-limitation" id="toc-q-limitation" class="nav-link" data-scroll-target="#q-limitation"><span class="header-section-number">4.3</span> Q limitation</a>
  <ul class="collapse">
  <li><a href="#parameters-1" id="toc-parameters-1" class="nav-link" data-scroll-target="#parameters-1"><span class="header-section-number">4.3.1</span> Parameters</a></li>
  <li><a href="#variables-2" id="toc-variables-2" class="nav-link" data-scroll-target="#variables-2"><span class="header-section-number">4.3.2</span> Variables</a></li>
  </ul></li>
  <li><a href="#current-limitation" id="toc-current-limitation" class="nav-link" data-scroll-target="#current-limitation"><span class="header-section-number">4.4</span> Current limitation</a>
  <ul class="collapse">
  <li><a href="#parameters-2" id="toc-parameters-2" class="nav-link" data-scroll-target="#parameters-2"><span class="header-section-number">4.4.1</span> Parameters</a></li>
  <li><a href="#variables-3" id="toc-variables-3" class="nav-link" data-scroll-target="#variables-3"><span class="header-section-number">4.4.2</span> Variables</a></li>
  </ul></li>
  <li><a href="#sec-mechanicalModule" id="toc-sec-mechanicalModule" class="nav-link" data-scroll-target="#sec-mechanicalModule"><span class="header-section-number">4.5</span> Mechanical module</a>
  <ul class="collapse">
  <li><a href="#parameters-3" id="toc-parameters-3" class="nav-link" data-scroll-target="#parameters-3"><span class="header-section-number">4.5.1</span> Parameters</a></li>
  <li><a href="#variables-4" id="toc-variables-4" class="nav-link" data-scroll-target="#variables-4"><span class="header-section-number">4.5.2</span> Variables</a></li>
  <li><a href="#initial-equations-2" id="toc-initial-equations-2" class="nav-link" data-scroll-target="#initial-equations-2"><span class="header-section-number">4.5.3</span> Initial equations</a></li>
  </ul></li>
  <li><a href="#sec-aerodynamic2d" id="toc-sec-aerodynamic2d" class="nav-link" data-scroll-target="#sec-aerodynamic2d"><span class="header-section-number">4.6</span> Two-dimensional aerodynamic module</a>
  <ul class="collapse">
  <li><a href="#parameters-4" id="toc-parameters-4" class="nav-link" data-scroll-target="#parameters-4"><span class="header-section-number">4.6.1</span> Parameters</a></li>
  <li><a href="#variables-5" id="toc-variables-5" class="nav-link" data-scroll-target="#variables-5"><span class="header-section-number">4.6.2</span> Variables</a></li>
  </ul></li>
  <li><a href="#pitch-angle-control-module" id="toc-pitch-angle-control-module" class="nav-link" data-scroll-target="#pitch-angle-control-module"><span class="header-section-number">4.7</span> Pitch angle control module</a>
  <ul class="collapse">
  <li><a href="#parameters-5" id="toc-parameters-5" class="nav-link" data-scroll-target="#parameters-5"><span class="header-section-number">4.7.1</span> Parameters</a></li>
  <li><a href="#initial-equations-3" id="toc-initial-equations-3" class="nav-link" data-scroll-target="#initial-equations-3"><span class="header-section-number">4.7.2</span> Initial equations</a></li>
  </ul></li>
  <li><a href="#generator-system-type-3" id="toc-generator-system-type-3" class="nav-link" data-scroll-target="#generator-system-type-3"><span class="header-section-number">4.8</span> Generator system type 3</a>
  <ul class="collapse">
  <li><a href="#description" id="toc-description" class="nav-link" data-scroll-target="#description"><span class="header-section-number">4.8.1</span> Description</a></li>
  <li><a href="#paramaters" id="toc-paramaters" class="nav-link" data-scroll-target="#paramaters"><span class="header-section-number">4.8.2</span> Paramaters</a></li>
  <li><a href="#variables-7" id="toc-variables-7" class="nav-link" data-scroll-target="#variables-7"><span class="header-section-number">4.8.3</span> Variables</a></li>
  <li><a href="#initial-equations-4" id="toc-initial-equations-4" class="nav-link" data-scroll-target="#initial-equations-4"><span class="header-section-number">4.8.4</span> Initial equations</a></li>
  <li><a href="#assumptions-in-modelica-implementation" id="toc-assumptions-in-modelica-implementation" class="nav-link" data-scroll-target="#assumptions-in-modelica-implementation"><span class="header-section-number">4.8.5</span> Assumptions in Modelica implementation</a></li>
  </ul></li>
  <li><a href="#grid-measurement-module" id="toc-grid-measurement-module" class="nav-link" data-scroll-target="#grid-measurement-module"><span class="header-section-number">4.9</span> Grid measurement module</a>
  <ul class="collapse">
  <li><a href="#parameters-6" id="toc-parameters-6" class="nav-link" data-scroll-target="#parameters-6"><span class="header-section-number">4.9.1</span> Parameters</a></li>
  <li><a href="#variables-8" id="toc-variables-8" class="nav-link" data-scroll-target="#variables-8"><span class="header-section-number">4.9.2</span> Variables</a></li>
  <li><a href="#initial-equations-5" id="toc-initial-equations-5" class="nav-link" data-scroll-target="#initial-equations-5"><span class="header-section-number">4.9.3</span> Initial equations</a></li>
  </ul></li>
  <li><a href="#protection-module" id="toc-protection-module" class="nav-link" data-scroll-target="#protection-module"><span class="header-section-number">4.10</span> Protection module</a>
  <ul class="collapse">
  <li><a href="#parameters-7" id="toc-parameters-7" class="nav-link" data-scroll-target="#parameters-7"><span class="header-section-number">4.10.1</span> Parameters</a></li>
  <li><a href="#variables-9" id="toc-variables-9" class="nav-link" data-scroll-target="#variables-9"><span class="header-section-number">4.10.2</span> Variables</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#wind-power-plant-model" id="toc-wind-power-plant-model" class="nav-link" data-scroll-target="#wind-power-plant-model"><span class="header-section-number">5</span> Wind power plant model</a>
  <ul class="collapse">
  <li><a href="#wp-p-control" id="toc-wp-p-control" class="nav-link" data-scroll-target="#wp-p-control"><span class="header-section-number">5.1</span> WP P Control</a>
  <ul class="collapse">
  <li><a href="#parameters-8" id="toc-parameters-8" class="nav-link" data-scroll-target="#parameters-8"><span class="header-section-number">5.1.1</span> Parameters</a></li>
  <li><a href="#variables-10" id="toc-variables-10" class="nav-link" data-scroll-target="#variables-10"><span class="header-section-number">5.1.2</span> Variables</a></li>
  <li><a href="#initial-equations-6" id="toc-initial-equations-6" class="nav-link" data-scroll-target="#initial-equations-6"><span class="header-section-number">5.1.3</span> Initial equations</a></li>
  </ul></li>
  <li><a href="#wp-q-control" id="toc-wp-q-control" class="nav-link" data-scroll-target="#wp-q-control"><span class="header-section-number">5.2</span> WP Q Control</a>
  <ul class="collapse">
  <li><a href="#variables-11" id="toc-variables-11" class="nav-link" data-scroll-target="#variables-11"><span class="header-section-number">5.2.1</span> Variables</a></li>
  <li><a href="#initial-equations-7" id="toc-initial-equations-7" class="nav-link" data-scroll-target="#initial-equations-7"><span class="header-section-number">5.2.2</span> Initial equations</a></li>
  </ul></li>
  <li><a href="#linear-communication-delay-module" id="toc-linear-communication-delay-module" class="nav-link" data-scroll-target="#linear-communication-delay-module"><span class="header-section-number">5.3</span> Linear communication delay module</a>
  <ul class="collapse">
  <li><a href="#parameters-9" id="toc-parameters-9" class="nav-link" data-scroll-target="#parameters-9"><span class="header-section-number">5.3.1</span> Parameters</a></li>
  <li><a href="#variables-12" id="toc-variables-12" class="nav-link" data-scroll-target="#variables-12"><span class="header-section-number">5.3.2</span> Variables</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#sec-baseValues" id="toc-sec-baseValues" class="nav-link" data-scroll-target="#sec-baseValues"><span class="header-section-number">6</span> Base values</a></li>
  <li><a href="#sec-initHelpersGlobal" id="toc-sec-initHelpersGlobal" class="nav-link" data-scroll-target="#sec-initHelpersGlobal"><span class="header-section-number">7</span> Operating point and initialization helpers</a></li>
  <li><a href="#open-questions" id="toc-open-questions" class="nav-link" data-scroll-target="#open-questions"><span class="header-section-number">8</span> Open questions</a></li>
  <li><a href="#information-about-dynawo-implementation-modelica" id="toc-information-about-dynawo-implementation-modelica" class="nav-link" data-scroll-target="#information-about-dynawo-implementation-modelica"><span class="header-section-number">9</span> Information about Dynawo implementation (modelica)</a>
  <ul class="collapse">
  <li><a href="#available-models" id="toc-available-models" class="nav-link" data-scroll-target="#available-models"><span class="header-section-number">9.1</span> Available models</a></li>
  <li><a href="#torque-pi-block-type-3" id="toc-torque-pi-block-type-3" class="nav-link" data-scroll-target="#torque-pi-block-type-3"><span class="header-section-number">9.2</span> Torque PI block (Type 3)</a></li>
  <li><a href="#pitch-angle-control-block" id="toc-pitch-angle-control-block" class="nav-link" data-scroll-target="#pitch-angle-control-block"><span class="header-section-number">9.3</span> Pitch angle control block</a></li>
  </ul></li>
  <li><a href="#table-of-references" id="toc-table-of-references" class="nav-link" data-scroll-target="#table-of-references"><span class="header-section-number">10</span> Table of references</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="..\..\WindType3.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li><li><a href="WindType3.docx"><i class="bi bi-file-word"></i>MS Word</a></li><li><a href="WindType3.md"><i class="bi bi-file-code"></i>Github (GFM)</a></li><li><a href="..\..\WindType3.pdf"><i class="bi bi-file-pdf"></i>Typst</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">IEC Wind Turbine Type 3 (Doubly-Fed Induction Generator)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://github.com/martinscripts">Martin Franke (Fraunhofer IEE), Luka Plavec (Fraunhofer IEE)</a> <a href="mailto:martin.franke@iee.fraunhofer.de" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="acronyms_HEADER_LOA" class="level1 loa" data-number="1">
<h1 class="loa" data-number="1"><span class="header-section-number">1</span> List Of Acronyms</h1>
<dl>
<dt><span id="acronyms_DFIG">DFIG</span></dt>
<dd>
Doubly-Fed Induction Generator
</dd>
<dt><span id="acronyms_FRT">FRT</span></dt>
<dd>
Fault Ride Through
</dd>
<dt><span id="acronyms_GSC">GSC</span></dt>
<dd>
Grid Side Converter
</dd>
<dt><span id="acronyms_PCC">PCC</span></dt>
<dd>
Point of Common Coupling
</dd>
<dt><span id="acronyms_PD">PD</span></dt>
<dd>
Power Device
</dd>
<dt><span id="acronyms_RSC">RSC</span></dt>
<dd>
Rotor Side Converter
</dd>
<dt><span id="acronyms_WP">WP</span></dt>
<dd>
Wind Plant
</dd>
<dt><span id="acronyms_WT">WT</span></dt>
<dd>
Wind Turbine
</dd>
</dl>
</section>
<section id="context" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Context</h1>
<p>This document refers to the IEC 61400-27-1 models which have been developed with the following specifications in mind <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>:</p>
<ul>
<li><p>Use in wind power plant models or standalone wind turbines</p></li>
<li><p>Specification for generic simulation models covering most WT types</p></li>
<li><p>Models address four categories of existing WT technologies (NERC nomenclature):</p>
<ul>
<li><strong>Type 1:</strong> Conventional asynchronous generators (squirrel cage)</li>
<li><strong>Type 2:</strong> Variable rotor resistance asynchronous generators</li>
<li><strong>Type 3:</strong> Doubly-fed induction generators (stator connected directly; rotor through converter)</li>
<li><strong>Type 4:</strong> Synchronous generator, grid-connected via a full-size power converter</li>
</ul></li>
</ul>
<p>Other model considerations according to <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>:</p>
<ul>
<li>Include over/under frequency and voltage protection for realistic WT disconnection modeling</li>
<li>Account for turbine-generator inertia and first drive train torsional mode impacts on power swings</li>
<li>Phase-locked loop dynamics are not included in the models (they are modeled through a first order lag element)</li>
</ul>
<p>The IEC 61400-27-1 <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> defines one of the most widely used series of RMS models for Wind Turbine (WT) generators, another one being the WECC model series, developed by EPRI.</p>
<p>The models are separated in several sub systems. The information and drawings are taken from <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> <span class="citation" data-cites="honrubia-escribano2018"><a href="#ref-honrubia-escribano2018" role="doc-biblioref">[2]</a></span> <span class="citation" data-cites="fortmann2014"><a href="#ref-fortmann2014" role="doc-biblioref">[3]</a></span> <span class="citation" data-cites="fortmann2014a"><a href="#ref-fortmann2014a" role="doc-biblioref">[4]</a></span> <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span> <span class="citation" data-cites="lorenzo-bonache2019"><a href="#ref-lorenzo-bonache2019" role="doc-biblioref">[6]</a></span>.</p>
</section>
<section id="model-use-assumptions-validity-domain-and-limitations" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Model use, assumptions, validity domain and limitations</h1>
<p>The controller of the generic Type 3 WT model does not represent the actual controller of the WT, which sets the references of the Rotor Side Converter (RSC) and the Grid Side Converter (GSC), but provides the current command signals to obtain an accurate response of active and reactive power, observed from the grid side.</p>
<p>The models are positive-sequence RMS models, hence they assume symmetrical operating conditions and neglect high-frequency dynamics. This type of models is often used in large-scale stability studies, for which it reflects the relevant phenomena. It is not a detailed physical model of the unit. Also for some stability phenomena (e.g.&nbsp;resonance stability) this model is not sufficient and EMT models or other approaches may be necessary.</p>
<p>Specifically, <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> defines the following validity domain:</p>
<ul>
<li>positive sequence dynamics</li>
<li>transmission grid simulations</li>
<li>reference value changes</li>
<li>steady state voltage deviations (0.85 pu … 1.15 pu)</li>
<li>phase jumps</li>
<li>symmetrical faults, including short-circuits of varying impedance, where voltage can dip to close to zero (typical e.g.&nbsp;0.18 pu)</li>
<li>frequency disturbances, variations <span class="math inline">\(\pm\)</span> 6 %</li>
<li>electromechanical modes of synchronous generator rotor oscillations (0.2 Hz … 4 Hz)</li>
<li>Typical simulation time frame: 10 s … 30 s</li>
<li>Wind speed assumed to be constant during simulation time (wind speed could be included as an external condition through the available power)</li>
<li>Simulation step width up to 1/4 fundamental frequency cycle (5 ms at 50 Hz), which implies that the model Bandwidth cannot be above 15 Hz.</li>
<li>According to <span class="citation" data-cites="honrubia-escribano2018"><a href="#ref-honrubia-escribano2018" role="doc-biblioref">[2]</a></span>, the Type 3 WT model can operate with variable speed with slip values from -0.3 to +0.4.</li>
</ul>
<p>Vice versa, <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> states that the models are not intended for the following:</p>
<ul>
<li>The models are not designed for long-term stability assessments.</li>
<li>The models do not facilitate the exploration of sub-synchronous interaction phenomena.</li>
<li>The models do not account for fluctuations due to wind speed variability over time and space, excluding factors such as turbulence, tower shadow, wind shear, and wakes.</li>
<li>The models do not encompass phenomena like harmonics, flicker, or other EMC emissions outlined in the IEC 61000 series.</li>
<li>Linearization for eigenvalue analysis is complex and may not be suitable for these simplified models.</li>
<li>The IEC standard does not cover the details of short-circuit calculations.</li>
<li>The models are not suitable for analyzing extremely weak systems, including scenarios where wind turbines operate in isolation from other synchronous generation or in cases with very low short-circuit ratios.</li>
<li>The models do not incorporate negative and zero sequence components.</li>
</ul>
</section>
<section id="wind-turbine-type-3" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Wind turbine type 3</h1>
<div id="fig-wtSystem" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wtSystem-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_system.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wtSystem-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Wind turbine type 3 model, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<div id="fig-wtControlSubstructure" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wtControlSubstructure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_generator_control_substructure_type3.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wtControlSubstructure-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Wind turbine generator control sub-structure for Type 3A and 3B WT, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<section id="sec-wt-p-control" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="sec-wt-p-control"><span class="header-section-number">4.1</span> P control module</h2>
<p>For detailed assessment of the parameters’ impact on model behaviour, see <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span>.</p>
<div id="fig-wtPControl" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wtPControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_P_control_type3.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wtPControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Wind turbine P control module (Type 3), based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<p><a href="#fig-wtPControl" class="quarto-xref">Figure&nbsp;3</a> shows the wind turbine active power control scheme.</p>
<p>The control’s general behaviour is dominated by <span class="math inline">\(\omega(p)\)</span>, a lookup-table that provides the angular velocity at which the turbine should rotate when it is injecting a certain active power <span class="citation" data-cites="lorenzo-bonache2019"><a href="#ref-lorenzo-bonache2019" role="doc-biblioref">[6]</a></span>. A possible look-up table for this system is shown in <a href="#fig-lookup-table-omega-pref" class="quarto-xref">Figure&nbsp;4</a>, which is representing example values from <em>DIgSILENT PowerFactory</em> <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span>.</p>
<p>The power-speed-characteristic in <a href="#fig-lookup-table-omega-pref" class="quarto-xref">Figure&nbsp;4</a> has four main operating zones according to <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span>:</p>
<ul>
<li><strong>Zone 1:</strong> The minimum rotational speed has been reached and hence cannot decrease further due to physical (component) limits, mainly maximum slip of the converter.</li>
<li><strong>Zone 2:</strong> Between minimum rotational speed to rated rotational speed; maximum power tracking mode.</li>
<li><strong>Zone 3:</strong> Fixed at rated speed and below the rated active power. In some cases, instead of a fixed rated rotational speed, there is a linear rotational speed variation to achieve the rated rotational speed at the rated active power.</li>
<li><strong>Zone 4:</strong> Rated rotational speed and rated active power.</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Dotted lines in <a href="#fig-lookup-table-omega-pref" class="quarto-xref">Figure&nbsp;4</a> imply that, for simulations, the active power reference presents a certain slope, offering more stable simulations. Under real control conditions, this look-up table has two vertical lines, as shown by the solid lines. <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span></p>
</div>
</div>
<div id="cell-fig-lookup-table-omega-pref" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>colors <span class="op">=</span> sns.color_palette(<span class="st">'Set2'</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>sns.set_palette(colors)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.755</span>,  <span class="fl">0.76</span>,   <span class="fl">0.86</span>,   <span class="fl">0.94</span>,   <span class="dv">1</span>,      <span class="fl">1.01</span>], </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>,      <span class="fl">0.3</span>,    <span class="fl">0.31</span>,   <span class="fl">0.4</span>,    <span class="fl">0.5</span>,    <span class="dv">1</span>], </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'--'</span>, c<span class="op">=</span>colors[<span class="dv">0</span>])</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>plt.plot(</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    [<span class="fl">0.76</span>,  <span class="fl">0.76</span>,   <span class="fl">0.86</span>,   <span class="fl">0.94</span>,   <span class="dv">1</span>,      <span class="dv">1</span>], </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    [<span class="dv">0</span>,     <span class="fl">0.3</span>,    <span class="fl">0.31</span>,   <span class="fl">0.4</span>,    <span class="fl">0.5</span>,    <span class="dv">1</span>], </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'-x'</span>, c<span class="op">=</span>colors[<span class="dv">0</span>])</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>plt.grid()</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> plt.ylabel(<span class="vs">r'$p_\mathrm</span><span class="sc">{WT}</span><span class="vs">$ in pu'</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> plt.xlabel(<span class="vs">r'$\omega_\mathrm</span><span class="sc">{ref}</span><span class="vs">$ in pu'</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>plt.xlim(<span class="fl">0.7</span>,<span class="fl">1.1</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> plt.text(<span class="fl">1.03</span>, <span class="fl">.99</span>, <span class="st">'Zone 4'</span>, ha<span class="op">=</span><span class="st">'left'</span>, va<span class="op">=</span><span class="st">'top'</span>)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> plt.text(<span class="fl">.99</span>, <span class="fl">.8</span>, <span class="st">'Zone 3'</span>, ha<span class="op">=</span><span class="st">'right'</span>, va<span class="op">=</span><span class="st">'top'</span>)</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> plt.text(<span class="fl">.9</span>, <span class="fl">.45</span>, <span class="st">'Zone 2'</span>, ha<span class="op">=</span><span class="st">'right'</span>, va<span class="op">=</span><span class="st">'top'</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> plt.text(<span class="fl">.745</span>, <span class="fl">.1</span>, <span class="st">'Zone 1'</span>, ha<span class="op">=</span><span class="st">'right'</span>, va<span class="op">=</span><span class="st">'top'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div id="fig-lookup-table-omega-pref" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-lookup-table-omega-pref-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="WindType3_files/figure-html/fig-lookup-table-omega-pref-output-1.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-lookup-table-omega-pref-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Lookup table for reference rotation speed as a function of WT active power; according to <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span> and with data from <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span> (see <a href="#tbl-wtLookupTable" class="quarto-xref">Table&nbsp;2</a>)
</figcaption>
</figure>
</div>
</div>
</div>
<p>The power-speed-characteristic’s speed reference output is then filtered (<span class="math inline">\(T_\mathrm{\omega ref}\)</span>) to avoid sudden changes.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The time constant <span class="math inline">\(T_\mathrm{\omega ref}\)</span> can be set to a very high value to enforce a fixed reference rotational speed during the simulation, which can be a desired operational mode. <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span></p>
</div>
</div>
<p>The filtered speed reference <span class="math inline">\(\omega_\mathrm{ref}\)</span> is subtracted from the measured angular velocity <span class="math inline">\(\omega_\text{gen}\)</span> (generator speed) or <span class="math inline">\(\omega_\mathrm{WTR}\)</span> (turbine speed), depending on the mode <span class="math inline">\(M_\mathrm{\omega Tqpi}\)</span> to get the speed error <span class="math inline">\(\omega_\mathrm{err}\)</span>. The measured speed can be filtered by the first order lag element with time constant <span class="math inline">\(T_\mathrm{\omega filtp3}\)</span>.</p>
<p>Since <span class="math inline">\(\omega_\mathrm{gen}\)</span> comes from the mechanical module which only models the drive train resonant frequency, this first order lag is intended as a filter for only this oscillation. Since it is a low pass, it won’t be able to efficiently filter that resonance from the signal. Alternatively, by setting <span class="math inline">\(M_\mathrm{\omega Tqpi}=\mathrm{true}\)</span>, the rotor speed <span class="math inline">\(\omega_\mathrm{WTR}\)</span> can be used instead of the generator speed, which acts as a simpler way to determine a filtered value of <span class="math inline">\(\omega_\mathrm{gen}\)</span> <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span>.</p>
<p>The speed error <span class="math inline">\(\omega_\mathrm{err}\)</span> is then given to the <em>Torque PI controller</em> (<a href="#fig-torquePi" class="quarto-xref">Figure&nbsp;5</a>), which outputs the electromagnetic torque reference <span class="math inline">\(\tau_\mathrm{out}\)</span> <span class="citation" data-cites="lorenzo-bonache2019"><a href="#ref-lorenzo-bonache2019" role="doc-biblioref">[6]</a></span>.</p>
<p>Another input to the torque PI subsystem (see section below) is the maximum electromagnetic torque <span class="math inline">\(\tau_\mathrm{emax}\)</span>. It is determined by calculating a torque value from <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span>:</p>
<ul>
<li>The reference power value <span class="math inline">\(p_\mathrm{WTref}\)</span>, during voltage dips optionally scaled down by the terminal voltage <span class="math inline">\(u_\mathrm{WTC}\)</span> (if <span class="math inline">\(M_\mathrm{pUscale}=\mathrm{true}\)</span>)</li>
<li>And a rotational speed, either the turbine rotor speed <span class="math inline">\(\omega_\mathrm{WTR}\)</span> (if <span class="math inline">\(M_\mathrm{\omega Tmax}=\mathrm{false}\)</span>) or the speed reference value <span class="math inline">\(\omega_\mathrm{ref}\)</span> (if <span class="math inline">\(M_\mathrm{\omega Tmax}=\mathrm{true}\)</span>).</li>
</ul>
<p>After the torque PI controller, the electromagnetic torque reference <span class="math inline">\(\tau_\mathrm{out}\)</span> is multiplied by the generator’s rotational speed <span class="math inline">\(\omega_\mathrm{gen}\)</span> to obtain a power reference <span class="citation" data-cites="lorenzo-bonache2019"><a href="#ref-lorenzo-bonache2019" role="doc-biblioref">[6]</a></span>.</p>
<p>To obtain the active current command <span class="math inline">\(i_\mathrm{pcmd}\)</span>, <span class="math inline">\(p_\mathrm{ord}\)</span> is divided by the measured voltage <span class="math inline">\(u_\mathrm{WTCfilt}\)</span>.</p>
<p>To the active power order <span class="math inline">\(p_\mathrm{ord}\)</span> an additional component from the Drive Train Damping (DTD) system is added. Physically, the DTD provides an electrical torque that accounts for natural damping by considering speed differences between both low and high speed shafts (either side of the gearbox) <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span>. It is modeled through a second-order transfer function as shown towards the bottom right of <a href="#fig-wtPControl" class="quarto-xref">Figure&nbsp;3</a>:</p>
<p><span class="math display">\[
K_{\text{DTD}} \cdot \frac{2 \zeta \omega_{\text{DTD}} s}{s^2 + 2 \zeta \omega_{\text{DTD}} s + \omega_{\text{DTD}}^2}
\]</span></p>
<p>As mentioned above, in this model the DTD is represented by an active power component, not a torque. The transfer function outputs an oscillating electrical power that has an efficient damping effect <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span> (for parameters see <a href="#tbl-parameters" class="quarto-xref">Table&nbsp;1</a>).</p>
<section id="sec-torque-pi" class="level3" data-number="4.1.1">
<h3 data-number="4.1.1" class="anchored" data-anchor-id="sec-torque-pi"><span class="header-section-number">4.1.1</span> Torque PI block</h3>
<div id="fig-torquePi" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-torquePi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_torque_pi.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-torquePi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Wind turbine torque PI block (Type 3), based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<p>In <a href="#fig-torquePi" class="quarto-xref">Figure&nbsp;5</a> the Torque PI Block can be seen. It acts as a PI-controller and is a subsystem of the active power control in <a href="#fig-wtPControl" class="quarto-xref">Figure&nbsp;3</a> <span class="citation" data-cites="lorenzo-bonache2019"><a href="#ref-lorenzo-bonache2019" role="doc-biblioref">[6]</a></span>.</p>
<p>For the calculation of the speed error input <span class="math inline">\(\omega_\mathrm{err}\)</span> and the maximum electromagnetic torque input <span class="math inline">\(\tau_\mathrm{emax}\)</span>, see <a href="#sec-wt-p-control" class="quarto-xref">Section&nbsp;4.1</a>.</p>
<p><strong>Proportional and integral parts of the controller</strong></p>
<p>The proportional controller part is realized by <span class="math inline">\(K_\mathrm{Pp}\)</span>.</p>
<p>The integral part of the controller output is the minimum of the following two signals <span class="citation" data-cites="lorenzo-bonache2019"><a href="#ref-lorenzo-bonache2019" role="doc-biblioref">[6]</a></span>:</p>
<ul>
<li>The output of the integral controller <span class="math inline">\(K_\mathrm{Ip}/K_\mathrm{Pp}\)</span></li>
<li>A torque value increasing as a ramp with rising rate <span class="math inline">\(\mathrm{d}\tau_\mathrm{max}\)</span>, which can be used to control the mechanical stress or to meet grid code requirements. This is set to <span class="math inline">\(\tau_\mathrm{reset}\)</span> when a low voltage fault occurs and ramps upwards after the fault.</li>
</ul>
<p><strong>Behavior during low voltage faults</strong></p>
<p>The <em>Delay Flag</em> block takes a boolean value <span class="math inline">\(F_\mathrm{i}\)</span> as input. If <span class="math inline">\(F_\mathrm{i}\)</span> steps to 1, the integer output <span class="math inline">\(F_\mathrm{o}\)</span> is 1 and a <em>timer</em> starts to run. As soon as <span class="math inline">\(F_\mathrm{i}\)</span> steps back to 0, <span class="math inline">\(F_\mathrm{o}\)</span> steps to 2 if the <em>timer</em> has not reached <span class="math inline">\(T_\mathrm{DVS}\)</span>. Once the timer reaches <span class="math inline">\(T_\mathrm{DVS}\)</span>, <span class="math inline">\(F_\mathrm{o}\)</span> steps back to 0. <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span></p>
<p>The delay flag block is used to implement the following fault signals:</p>
<ul>
<li><span class="math inline">\(F_\mathrm{reset}\)</span> is true during a volage dip (<span class="math inline">\(u_\mathrm{WTC} &lt; u_\mathrm{pdip}\)</span>) as well as during and <span class="math inline">\(T_\mathrm{DVS}\)</span> after a deep voltage dip (<span class="math inline">\(u_\mathrm{WTC} &lt; u_\mathrm{DVS}\)</span>).</li>
<li><span class="math inline">\(F_\mathrm{freeze\,I}\)</span> is true during a voltage dip (<span class="math inline">\(u_\mathrm{WTC} &lt; u_\mathrm{pdip}\)</span>)</li>
</ul>
<p>These fault signals have the following functions:</p>
<ul>
<li><span class="math inline">\(F_\mathrm{reset}\)</span>, while true,
<ul>
<li>resets and holds both integrators at <span class="math inline">\(\tau_\mathrm{reset}\)</span> (see below); for the <span class="math inline">\(K_\mathrm{Ip}/K_\mathrm{Pp}\)</span>-integrator this can be prevented by setting <span class="math inline">\(M_\mathrm{pUVRT} = \mathrm{false}\)</span>.</li>
<li>sets the speed error <span class="math inline">\(\omega_\mathrm{err}\)</span>, i.e.&nbsp;the input to the proportional controller part <span class="math inline">\(K_\mathrm{Pp}\)</span>, to zero</li>
<li>changes the upper ramp rate limit of <span class="math inline">\(\tau_\mathrm{reset}\)</span> to <span class="math inline">\(\mathrm{d}\tau_\mathrm{maxUVRT}\)</span> (usually set to zero, preventing <span class="math inline">\(\tau_\mathrm{reset}\)</span> from inceasing during fault) <span class="citation" data-cites="lorenzo-bonache2019"><a href="#ref-lorenzo-bonache2019" role="doc-biblioref">[6]</a></span></li>
</ul></li>
<li><span class="math inline">\(F_\mathrm{freeze\,I}\)</span> freezes the integral controller part (<span class="math inline">\(K_\mathrm{Ip}/K_\mathrm{Pp}\)</span>) while true.</li>
</ul>
<p>The reset value <span class="math inline">\(\tau_\mathrm{reset}\)</span> is the minimum value of:</p>
<ul>
<li>The measured voltage (during fault) multiplied by factor <span class="math inline">\(\tau_\mathrm{uscale}\)</span></li>
<li>The output <span class="math inline">\(\tau_\mathrm{I}\)</span> of the integrator itself</li>
<li><span class="math inline">\(u_\mathrm{TChook} + 1\)</span></li>
</ul>
<p><span class="math inline">\(\tau_\mathrm{uscale}\)</span> can be used to alter the power injection behaviour during fault and also the starting point for power recovery after post-fault. For example, setting it to zero results in zero power injection during fault. Higher values increase power injection, until the current limitation system begins to act. See <span class="citation" data-cites="lorenzo-bonache2019"><a href="#ref-lorenzo-bonache2019" role="doc-biblioref">[6]</a></span> for further details.</p>
<p>When <span class="math inline">\(F_\mathrm{reset}\)</span> returns to false, the proportional controller <span class="math inline">\(K_\mathrm{Pp}\)</span> will work again as before the fault. The integral controller will increase from <span class="math inline">\(\tau_\mathrm{reset}\)</span> to steady-state, with a maximum rate dictated by <span class="math inline">\(\mathrm{d}\tau_\mathrm{max}\)</span> <span class="citation" data-cites="lorenzo-bonache2019"><a href="#ref-lorenzo-bonache2019" role="doc-biblioref">[6]</a></span>.</p>
</section>
<section id="variable-limits-integrator-with-setreset-and-freeze" class="level3" data-number="4.1.2">
<h3 data-number="4.1.2" class="anchored" data-anchor-id="variable-limits-integrator-with-setreset-and-freeze"><span class="header-section-number">4.1.2</span> Variable limits integrator with set/reset and freeze</h3>
<p>The integrators used in the Torque PI model in <a href="#fig-torquePi" class="quarto-xref">Figure&nbsp;5</a> need variable limits, set/reset and freeze functionalities. A suggestion for the implementation is shown below and the description follows thereafter.</p>
<pre class="{modelica}"><code>model IntegratorVariableLimitsContinuousSetFreeze "Integrator with limited value of output (variable limits), set/reset and freeze"
    parameter Boolean DefaultLimitMax = true "If limitMin &gt; limitMax : if true, y = limitMax, if false, y = limitMin";
    parameter Real K = 1 "Integrator gain";
    parameter Real LimitMax0 "Initial value of upper limit";
    parameter Real LimitMin0 "Initial value of lower limit";
    parameter Boolean ReinitWhenResetIsReleased = true "true: integrator state gets reinitialized to 'set' when 'reset' turns false. false: integrator state gets reinitialized to 'set' when 'reset' turns true.";
    parameter Real tDer = 1e-3 "Time constant of derivative filter for limits in s";
    parameter Real TolInput = 1e-5 "Tolerance on limit crossing for integrator input";
    parameter Real TolOutput = 1e-5 "Tolerance on limit crossing for integrator output";
    parameter Real LimitDeadband = 0.001 "Deadband for detecting a limit crossing of the integrator's state";
    Real w(start = Y0) "Integrator state variable";
    parameter Real Y0 = 0 "Initial or guess value of output (must be in the limits limitMin .. limitMax)";

    Real kFreezeMax "Freeze coefficient for upper limit";
    Real kFreezeMin "Freeze coefficient for lower limit";
    Real derLimitMax "Filtered derivative of upper limit of output";
    Real derLimitMin "Filtered derivative of lower limit of output";
    Modelica.Blocks.Interfaces.BooleanInput freeze "Optional connector of freeze signal";
    Modelica.Blocks.Interfaces.RealInput limitMax "Connector of Real input signal used as maximum of output y";
    Modelica.Blocks.Interfaces.RealInput limitMin "Connector of Real input signal used as minimum of output y";
    Modelica.Blocks.Interfaces.BooleanInput reset "Optional connector of reset signal";
    Modelica.Blocks.Interfaces.RealInput set "Optional connector of set signal";
equation
    
    ////////// reset or freeze: keep input = 0
    if freeze or reset then
        v = 0;
    else
        v = K * u;
    end if;
    
    ////////// reset: reinit integrator's state when set becomes false (or true, depending on ReinitWhenResetIsReleases)
    when if ReinitWhenResetIsReleased then not reset else reset then
      reinit(w, set);
    end when;
    
    ////////// integrator with limits
    derLimitMax = der(limitMax);
    derLimitMin = der(limitMin);
    kFreezeMax = 1 / 4 * (1 + tanh((w - limitMax) / TolOutput)) * (1 + tanh((v - derLimitMax) / TolInput));
    kFreezeMin = 1 / 4 * (1 + tanh((limitMin - w) / TolOutput)) * (1 + tanh((derLimitMin - v) / TolInput));
    der(w) = derLimitMax * kFreezeMax + derLimitMin * kFreezeMin + v * (1 - kFreezeMax - kFreezeMin);
    
    ////////// apply limit or set to output
    if limitMin &gt; limitMax and DefaultLimitMax then
        y = limitMax;
    elseif limitMin &gt; limitMax then
        y = limitMin;
    elseif w &gt; limitMax+LimitDeadband then
        y = limitMax;
    elseif w &lt; limitMin-LimitDeadband then
        y = limitMin;
    elseif reset then
        y = set;
    else
        y = w;
    end if;
end IntegratorVariableLimitsContinuousSetFreeze;</code></pre>
<p>This blocks computes <code>w</code> as integral of the input <code>u</code> multiplied by the gain <code>K</code>, with <code>v = K * u</code>. If the integral reaches a given upper limit limitMax or lower limit limitMin, the integration is halted and only restarted if the input drives the integral away from the bounds.</p>
<p>This freeze is imposed through two coefficients <code>kFreezeMax</code> and <code>kFreezeMin</code>, each defined by a continuous expression involving the hyperbolic tangent, the integrator input <code>v</code>, the integrator output <code>w</code>, the limit <code>limitMax</code> or <code>limitMin</code> and its filtered derivative <code>derLimitMax</code> or <code>derLimitMin</code>.</p>
<p>The parameters <code>TolInput</code> and <code>TolOutput</code> determine the width of the transition zone from one domain to another.</p>
<p>The output <code>y</code> is the result of the limitation of <code>w</code> by both variable limits.</p>
<p>If the “upper” limit is smaller than the “lower” one, the output <code>y</code> is ruled by the parameter <code>DefaultLimitMax</code>: <code>y</code> is equal to either <code>limitMax</code> or <code>limitMin</code>.</p>
<p><strong>set/reset</strong></p>
<p>The integrator’s output is forced to the value of <code>set</code> while <code>reset=true</code>, as it is descibed in <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>.</p>
<p>When <code>reset</code> returns to false (=falling edge), the integrator’s state is reinitialized to set to resume integration without a jump discontinuity (change <code>ReinitWhenResetIsReleased</code> to <code>false</code> to reinitialize at a rising edge instead).</p>
<p><strong>freeze</strong></p>
<p>If boolean input is set to true, the derivative of the state variable is set to zero.</p>
</section>
<section id="sec-wt-p-params" class="level3" data-number="4.1.3">
<h3 data-number="4.1.3" class="anchored" data-anchor-id="sec-wt-p-params"><span class="header-section-number">4.1.3</span> Parameters</h3>
<p>Typical values were gathered from the <em>DIgSILENT PowerFactory</em> <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span> implementation of the model.</p>
<div id="tbl-parameters" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[8,6,5,16,20,35,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parameters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Parameters of WT P control module, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>, <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span> and <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span>
</figcaption>
<div aria-describedby="tbl-parameters-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 35%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">modelica name</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">typical value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}p_{\mathrm{max}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_{\mathrm{base}} / \mathrm{s}\)</span></td>
<td style="text-align: left;">DPMaxPu</td>
<td style="text-align: left;">Maximum ramp rate of wind turbine power</td>
<td style="text-align: left;">999</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}p_{\mathrm{refmax}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_{\mathrm{base}} / \mathrm{s}\)</span></td>
<td style="text-align: left;">DPRefMaxPu</td>
<td style="text-align: left;">Maximum ramp rate for reference power of the wind turbine</td>
<td style="text-align: left;">0.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}p_{\mathrm{refmin}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_{\mathrm{base}} / \mathrm{s}\)</span></td>
<td style="text-align: left;">DPRefMinPu</td>
<td style="text-align: left;">Minimum ramp rate for reference power of the wind turbine</td>
<td style="text-align: left;">-0.3</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}\tau_{\mathrm{max}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(T_{\mathrm{base}} / \mathrm{s}\)</span></td>
<td style="text-align: left;">DTauMaxPu</td>
<td style="text-align: left;">Torque ramp rate limit, as required by some grid codes</td>
<td style="text-align: left;">0.25</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}\tau_{\mathrm{maxUVRT}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(T_{\mathrm{base}} / \mathrm{s}\)</span></td>
<td style="text-align: left;">DTauUvrtMaxPu</td>
<td style="text-align: left;">Torque rise rate limit during UVRT</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(K_{\mathrm{DTD}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_{\mathrm{base}} / \Omega_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">KDtd</td>
<td style="text-align: left;">Active drive train damping: gain</td>
<td style="text-align: left;">1.5 (or 0 if <span class="math inline">\(M_\mathrm{\omega Tqpi}=\mathrm{false}\)</span>) <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(K_{\mathrm{Ip}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(T_{\mathrm{base}} / \Omega_{\mathrm{base}} / \mathrm{s}\)</span></td>
<td style="text-align: left;">KIp</td>
<td style="text-align: left;">Integrator time constant of the PI controller</td>
<td style="text-align: left;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(K_{\mathrm{Pp}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(T_{\mathrm{base}} / \Omega_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">KPp</td>
<td style="text-align: left;">Proportional gain of the PI controller</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(M_\mathrm{\omega Tmax}\)</span></td>
<td style="text-align: left;">bool</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">MOmegaTMax</td>
<td style="text-align: left;">Mode for source of rotational speed for maximum torque calculation <span class="math inline">\((false: \omega_{\mathrm{WTR}} - true: \omega_{\mathrm{ref}})\)</span></td>
<td style="text-align: left;">true</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(M_\mathrm{\omega Tqpi}\)</span></td>
<td style="text-align: left;">bool</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">MOmegaTqpi</td>
<td style="text-align: left;">Mode for source of rotational speed for torque PI controller error calculation <span class="math inline">\((false: \omega_{\mathrm{gen}} - true: \omega_{\mathrm{WTR}})\)</span></td>
<td style="text-align: left;">true (or false if <span class="math inline">\(K_\mathrm{DTD}=0\)</span>) <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(M_{\mathrm{pUscale}}\)</span></td>
<td style="text-align: left;">bool</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">MPUscale</td>
<td style="text-align: left;">Enable voltage scaling for power reference during a voltage dip (false: no scaling – true: u scaling)</td>
<td style="text-align: left;">false</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(M_{\mathrm{pUVRT}}\)</span></td>
<td style="text-align: left;">bool</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">MPUvrt</td>
<td style="text-align: left;">Mode for UVRT power control (false: reactive power control – true: voltage control)</td>
<td style="text-align: left;">true</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\omega_{\mathrm{DTD}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">OmegaDtdPu</td>
<td style="text-align: left;">Active drive train damping: frequency, derived from two-mass model parameters, see <a href="#eq-omegaDtd" class="quarto-xref">Equation&nbsp;1</a></td>
<td style="text-align: left;">11.3</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\omega_{\mathrm{offset}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">OmegaOffsetPu</td>
<td style="text-align: left;">Offset from the reference value to limit controller action during rotor speed changes</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\omega(p)\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_{\mathrm{base}}(S_{\mathrm{base}})\)</span></td>
<td style="text-align: left;">TableOmegaPPu</td>
<td style="text-align: left;">Lookup table for power as a function of speed</td>
<td style="text-align: left;">see <a href="#tbl-wtLookupTable" class="quarto-xref">Table&nbsp;2</a></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(p_{\mathrm{DTDmax}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">PDtdMaxPu</td>
<td style="text-align: left;">Active drive train damping: maximum power</td>
<td style="text-align: left;">0.15</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\tau_{\mathrm{emin}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(T_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">TauEMinPu</td>
<td style="text-align: left;">Minimum torque for the electrical generator</td>
<td style="text-align: left;">0.001</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\tau_{\mathrm{uscale}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(T_{\mathrm{base}} / U_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">TauUscalePu</td>
<td style="text-align: left;">Voltage scaling factor for reset torque</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(T_{\mathrm{DVS}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">tDvs</td>
<td style="text-align: left;">Time delay following deep a voltage dip</td>
<td style="text-align: left;">0.05</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(T_{\mathrm{\omega filtp3}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">tOmegafiltp3</td>
<td style="text-align: left;">Filter time constant for measuring generator speed</td>
<td style="text-align: left;">0.005</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(T_{\mathrm{\omega ref}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">tOmegaRef</td>
<td style="text-align: left;">Time constant in the speed reference filter</td>
<td style="text-align: left;">0.005</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(T_{\mathrm{pord}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">tPord</td>
<td style="text-align: left;">Power order lag time constant</td>
<td style="text-align: left;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(u_{\mathrm{DVS}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">UDvsPu</td>
<td style="text-align: left;">Voltage limit for maintaining UVRT status after a deep voltage dip</td>
<td style="text-align: left;">0.15</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(u_{\mathrm{pdip}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">UPdipPu</td>
<td style="text-align: left;">Voltage dip threshold for active power control, often different from converter thresholds (e.g., 0.8)</td>
<td style="text-align: left;">0.9</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\zeta\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Zeta</td>
<td style="text-align: left;">Active drive train damping: damping coefficient</td>
<td style="text-align: left;">0.5</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>According to <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>, using rotor speed instead of generator speed (by setting <span class="math inline">\(M_\mathrm{\omega Tqpi} = true\)</span>) is an easy way to filter the speed measurement.</p>
</div>
</div>
<div id="tbl-wtLookupTable" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-wtLookupTable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Typical values for lookup table <span class="math inline">\(\omega(p)\)</span>, based on <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span> implementation
</figcaption>
<div aria-describedby="tbl-wtLookupTable-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<thead>
<tr class="header">
<th style="text-align: left;"><span class="math inline">\(p\)</span></th>
<th style="text-align: left;"><span class="math inline">\(\omega(p)\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">0.76</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.3</td>
<td style="text-align: left;">0.76</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0.31</td>
<td style="text-align: left;">0.86</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.4</td>
<td style="text-align: left;">0.94</td>
</tr>
<tr class="odd">
<td style="text-align: left;">0.5</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="variables" class="level3" data-number="4.1.4">
<h3 data-number="4.1.4" class="anchored" data-anchor-id="variables"><span class="header-section-number">4.1.4</span> Variables</h3>
<section id="inputs" class="level4" data-number="4.1.4.1">
<h4 data-number="4.1.4.1" class="anchored" data-anchor-id="inputs"><span class="header-section-number">4.1.4.1</span> Inputs</h4>
<div id="tbl-inputsPControl" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[8,6,5,16,20,35]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-inputsPControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Inputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span>
</figcaption>
<div aria-describedby="tbl-inputsPControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">modelica name</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{pmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\frac{S_\mathrm{base}}{\sqrt{3}U_\mathrm{base}}\)</span></td>
<td style="text-align: left;">ipMaxPu</td>
<td style="text-align: left;">Maximum active current able to be injected into the grid by the WT as determined by the current limitation system.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\omega_\mathrm{gen}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_\mathrm{base}\)</span></td>
<td style="text-align: left;">omegaGenPu</td>
<td style="text-align: left;">Angular velocity of generator</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\omega_\mathrm{WTR}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_\mathrm{base}\)</span></td>
<td style="text-align: left;">omegaWTRPu</td>
<td style="text-align: left;">Angular velocity of Wind Turbine Rotor (WTR)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{WTCfilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">PWTCFiltPu</td>
<td style="text-align: left;">Measured (=filtered) active power for Wind Turbine Control (WTC), obtained from the electrical generator system</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{WTref}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">PWTRefPu</td>
<td style="text-align: left;">Active power reference to be injected into the grid by the wind turbine (WT) (manually adjusted)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{TChook}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">UTCHookPu</td>
<td style="text-align: left;">Turbine control voltage external hook, usually = 0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{WTC}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">UWTCPu</td>
<td style="text-align: left;">Unfiltered voltage for Wind Turbine Control (WTC) obtained from the electrical generator system</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{WTCfilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">UWTCFiltPu</td>
<td style="text-align: left;">Measured (=filtered) voltage for Wind Turbine Control (WTC) obtained from the electrical generator system</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outputs" class="level4" data-number="4.1.4.2">
<h4 data-number="4.1.4.2" class="anchored" data-anchor-id="outputs"><span class="header-section-number">4.1.4.2</span> Outputs</h4>
<div id="tbl-outputsPControl" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[8,6,5,16,20,35]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outputsPControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Outputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-outputsPControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 16%">
<col style="width: 20%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">modelica name</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{pcmd}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\frac{S_\mathrm{base}}{\sqrt{3}U_\mathrm{base}}\)</span></td>
<td style="text-align: left;">ipCmdPu</td>
<td style="text-align: left;">Active current command for generator system model</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\omega_\mathrm{ref}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_\mathrm{base}\)</span></td>
<td style="text-align: left;">omegaRefPu</td>
<td style="text-align: left;">Angular velocity reference value</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{ord}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">POrdPu</td>
<td style="text-align: left;">Active power order from wind turbine controller</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="equations-algorithm" class="level3" data-number="4.1.5">
<h3 data-number="4.1.5" class="anchored" data-anchor-id="equations-algorithm"><span class="header-section-number">4.1.5</span> Equations &amp; algorithm &nbsp;</h3>
<p><span id="eq-omegaDtd"><span class="math display">\[
\omega_{\mathrm{DTD}} = \sqrt{k_{\mathrm{drt}} \left( \frac{1}{2 \cdot H_{\mathrm{WTR}}} + \frac{1}{2 \cdot H_{\mathrm{gen}}} \right)}
\tag{1}\]</span></span></p>
<p>(parameters from mechanical module)</p>
</section>
<section id="initial-equations" class="level3" data-number="4.1.6">
<h3 data-number="4.1.6" class="anchored" data-anchor-id="initial-equations"><span class="header-section-number">4.1.6</span> Initial equations</h3>
<p>For the used initialization helper variables, see <a href="#sec-initHelpersGlobal" class="quarto-xref">Section&nbsp;7</a>.</p>
<p>The lookup-table <span class="math inline">\(\mathbf{\omega}(p)\)</span> is the same as described in <a href="#fig-lookup-table-omega-pref" class="quarto-xref">Figure&nbsp;4</a>.</p>
<p><span id="eq-initPOrd"><span class="math display">\[
x_\mathrm{pord\,0} = P_\mathrm{ord\,0}
\tag{2}\]</span></span></p>
<p><span id="eq-initDtd"><span class="math display">\[
x_\mathrm{DTD1\,0} = x_\mathrm{DTD2\,0} = 0 \text{ (make sure to obtain steady zero output)}
\tag{3}\]</span></span></p>
<p><span id="eq-initOmegaRef"><span class="math display">\[
x_\mathrm{\omega ref\,0} = \mathbf{\omega}(P_\mathrm{0})
\tag{4}\]</span></span></p>
<p><span id="eq-initOmegaFiltP3"><span class="math display">\[
x_\mathrm{\omega filtp3\,0} = \omega_0
\tag{5}\]</span></span></p>
<p><span id="eq-initDPRefMax"><span class="math display">\[
x_\mathrm{dprefmax\,0} = P_\mathrm{WTRef\,0}
\tag{6}\]</span></span></p>
<p><span id="eq-initDTauMax"><span class="math display">\[
x_\mathrm{\tau reset\,0} =
\begin{cases}
    U_\mathrm{0} \cdot \tau_\mathrm{uscale}, &amp; \text{if } U_\mathrm{0} \cdot \tau_\mathrm{uscale} &lt; P_\mathrm{ord\,0}/\omega_0\\
    P_\mathrm{ord\,0}/\omega_0,              &amp; \mathrm{otherwise}
\end{cases}
\tag{7}\]</span></span></p>
<p><span id="eq-initDTauMax"><span class="math display">\[
x_\mathrm{d\tau max\,0} = \tau_\mathrm{emax\,0}
\tag{8}\]</span></span></p>
<p><span id="eq-initTauEMax"><span class="math display">\[
\tau_\mathrm{emax\,0} =
\begin{cases}
    P_\mathrm{WTRef\,0} / \mathbf{\omega}(P_\mathrm{0}),&amp; \text{if } M_\mathrm{\omega T max}\\
    P_\mathrm{WTRef\,0} / \omega_0,              &amp; \mathrm{otherwise}
\end{cases}
\tag{9}\]</span></span></p>
<p><span id="eq-initTauEMax"><span class="math display">\[
x_\mathrm{KIpKPp\,0} =
\begin{cases}
    \tau_\mathrm{emax\,0},&amp; \text{if } P_\mathrm{ord\,0}/\omega_0 &gt; \tau_\mathrm{emax\,0}\\
    \tau_\mathrm{emin},&amp; \text{if } P_\mathrm{ord\,0}/\omega_0 &lt; \tau_\mathrm{emin}\\
    P_\mathrm{ord\,0}/\omega_0,              &amp; \mathrm{otherwise}
\end{cases}
\tag{10}\]</span></span></p>
</section>
</section>
<section id="q-control-module" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="q-control-module"><span class="header-section-number">4.2</span> Q control module</h2>
<div id="fig-QControlModule" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-QControlModule-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_Q_control.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-QControlModule-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Wind turbine Q control module, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<p>The WT Q Control Module consists of a normal path and a fast reactive current injection path, which acts during and some time after an event (voltage drop or rise). There are multiple possible operating modes for each path, described in detail in <span class="citation" data-cites="franke2024"><a href="#ref-franke2024" role="doc-biblioref">[8]</a></span>.</p>
<p>Depending on the mode, <span class="math inline">\(x_\mathrm{WTref}\)</span> can be a voltage or reactive power setpoint.</p>
<p>The available control modes are listed in <a href="#tbl-qControlModesNormal" class="quarto-xref">Table&nbsp;5</a> and <a href="#tbl-qControlModesFast" class="quarto-xref">Table&nbsp;6</a>. The following descriptions have been based on <span class="citation" data-cites="franke2024"><a href="#ref-franke2024" role="doc-biblioref">[8]</a></span> and <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>.</p>
<p>For example in mode 1, the normal path consists of two cascaded Proportional-Integral (PI) controllers. The first one (reactive power controller) controls reactive power by generating a voltage reference for the second controller (voltage controller), which then generates the reactive current command <span class="math inline">\(i_\mathrm{qbasehook}\)</span>. Input and output limitations are applied.</p>
<p>During faults, the fast injection path adds an additional component to the q-axis current which is computed based on the voltage deviation <span class="math inline">\(\Delta u\)</span>, a dead-band and droop (gain <span class="math inline">\(K_\mathrm{qv}\)</span>).</p>
<p>Special attention must be paid to the reactive current signs in <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>, as they seem to be inconsistent <span class="citation" data-cites="franke2024"><a href="#ref-franke2024" role="doc-biblioref">[8]</a></span>. In the fast injection path, <span class="math inline">\(u_\mathrm{WTC}\)</span> voltage drop leads to <span class="math inline">\(\Delta u &lt; 0\)</span>, resulting in <span class="math inline">\(i_\mathrm{qvhook} &lt; 0\)</span>. This behavior is opposite to the normal path. To solve this, the fast injection path’s sign can be inverted, as has been done in <a href="#fig-QControlModule" class="quarto-xref">Figure&nbsp;6</a> (red -1 block).</p>
<div id="tbl-qControlModesNormal" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-qControlModesNormal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Q control normal path control modes, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-qControlModesNormal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 83%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><span class="math inline">\(M_\mathrm{qG}\)</span></th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">Voltage control</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Reactive power control</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Open loop reactive power control (only used with closed loop at plant level)</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">Power factor control</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: left;">Open loop power factor control</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<div id="tbl-qControlModesFast" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-qControlModesFast-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6: Q control reactive current injection path control modes, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-qControlModesFast-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 65%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><span class="math inline">\(M_\mathrm{qFRT}\)</span></th>
<th style="text-align: left;">During Fault</th>
<th style="text-align: left;">Post Fault</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">0</td>
<td style="text-align: left;">A function of the voltage change compared to the pre-fault voltage</td>
<td style="text-align: left;">Same function as during fault</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">Pre-fault current plus a term depending on the voltage change compared to the pre-fault voltage</td>
<td style="text-align: left;">Same function as during fault</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: left;">Pre-fault current plus a term depending on the voltage change compared to the pre-fault voltage</td>
<td style="text-align: left;">Pre-fault current plus a constant</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">User defined</td>
<td style="text-align: left;">User defined</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<section id="parameters" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="parameters"><span class="header-section-number">4.2.1</span> Parameters</h3>
<div id="tbl-parametersQControl" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,44,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parametersQControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7: Parameters of WT Q control, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span>
</figcaption>
<div aria-describedby="tbl-parametersQControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 44%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">typical value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\Delta u_\mathrm{db1}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Voltage difference dead band lower limit</td>
<td style="text-align: left;">-0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\Delta u_\mathrm{db2}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Voltage differnce dead band upper limit</td>
<td style="text-align: left;">0.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{qh1}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">Maximum reactive current injection during FRT</td>
<td style="text-align: left;">1.05</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{qmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">Maximum reactive current injection</td>
<td style="text-align: left;">1.05</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{qmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">Minimum reactive current injection</td>
<td style="text-align: left;">-1.05</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{qpost}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">Post-fault reactive current injection</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{Iq}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}/S_\mathrm{base}/s\)</span></td>
<td style="text-align: left;">Q PI controller integral gain</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{Iu}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}/U_\mathrm{base}/s\)</span></td>
<td style="text-align: left;">U PI controller integral gain</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{Pq}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}/S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Q PI controller proportional gain</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{Pu}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}/U_\mathrm{base}\)</span></td>
<td style="text-align: left;">U PI controller proportional gain</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{PuFRT}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}/U_\mathrm{base}\)</span></td>
<td style="text-align: left;">U PI controller proportional gain during FRT</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{qv}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}/U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Droop for fast reactive current injection</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(M_\mathrm{qFRT}\)</span></td>
<td style="text-align: left;">bool</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Fast reactive current injection Q control mode (<a href="#tbl-qControlModesFast" class="quarto-xref">Table&nbsp;6</a>)</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(M_\mathrm{qG}\)</span></td>
<td style="text-align: left;">bool</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Normal path Q control mode (<a href="#tbl-qControlModesNormal" class="quarto-xref">Table&nbsp;5</a>)</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(r_\mathrm{drop}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(Z_\mathrm{base}\)</span></td>
<td style="text-align: left;">Voltage drop resistance</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{post}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Duration of post-fault period</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{qord}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Time constant in reactive power order lag</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{uss}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Steady state voltage filter time constant</td>
<td style="text-align: left;">30</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{max}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Upper limit in U PI controller integrator</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{min}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Lower limit in U PI controller integrator</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{qdip}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Q control: voltage threshold for UVRT detection</td>
<td style="text-align: left;">0.9</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{qrise}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Q Control: Voltage threshold for OVRT detection</td>
<td style="text-align: left;">1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{ref0}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Voltage reference bias</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{drop}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(Z_\mathrm{base}\)</span></td>
<td style="text-align: left;">Voltage drop reactance</td>
<td style="text-align: left;">0</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="variables-1" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="variables-1"><span class="header-section-number">4.2.2</span> Variables:</h3>
<section id="inputs-1" class="level4" data-number="4.2.2.1">
<h4 data-number="4.2.2.1" class="anchored" data-anchor-id="inputs-1"><span class="header-section-number">4.2.2.1</span> Inputs</h4>
<div id="tbl-inputsQControl" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-inputsQControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8: Inputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span>
</figcaption>
<div aria-describedby="tbl-inputsQControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 3%">
<col style="width: 2%">
<col style="width: 12%">
<col style="width: 66%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{dfhook}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">user-defined input for during-fault reactive current</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{pfhook}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">user-defined input for post-fault period reactive current</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{WTCfilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">measured active power</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(q_\mathrm{WTCfilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">measured reactive power</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(q_\mathrm{WTmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">maximum reactive power from Q limitation module (may be used to implement a capability curve)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(q_\mathrm{WTmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">minimum reactive power from Q limitation module (may be used to implement a capability curve)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{WTCfilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">measured voltage</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{WTref}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(Z_\mathrm{base}\)</span></td>
<td style="text-align: left;">voltage or reactive power reference, depending on control mode</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outputs-1" class="level4" data-number="4.2.2.2">
<h4 data-number="4.2.2.2" class="anchored" data-anchor-id="outputs-1"><span class="header-section-number">4.2.2.2</span> Outputs</h4>
<div id="tbl-outputsQControl" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outputsQControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;9: Outputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-outputsQControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 17%">
<col style="width: 5%">
<col style="width: 3%">
<col style="width: 13%">
<col style="width: 59%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(F_\mathrm{FRT}\)</span></td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Fault signal: 0=no fault, 1=fault, 2=post-fault</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{qbasehook}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">Normal path component of reactive current command</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{qcmd}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">reactive current command</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{qvhook}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">Fast reactive current injection path component of reactive current command</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="initial-equations-1" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="initial-equations-1"><span class="header-section-number">4.2.3</span> Initial equations</h3>
<p>For the used initialization helper variables, see <a href="#sec-initHelpersGlobal" class="quarto-xref">Section&nbsp;7</a>.</p>
<p><span id="eq-initXiu"><span class="math display">\[
x_\mathrm{Iu\,0} = x_\mathrm{qord\,0} = Q_\mathrm{ord\,0}/U_\mathrm{0}
\tag{11}\]</span></span></p>
<p><span id="eq-initXiq"><span class="math display">\[
x_\mathrm{Iq\,0} = U_\mathrm{0}
\tag{12}\]</span></span></p>
<p><span id="eq-initXuss"><span class="math display">\[
x_\mathrm{uss\,0} = 0
\tag{13}\]</span></span></p>
</section>
</section>
<section id="q-limitation" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="q-limitation"><span class="header-section-number">4.3</span> Q limitation</h2>
<div id="fig-WTQLim" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-WTQLim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_Qlim.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-WTQLim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: WT Q limitation module, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<p>The Q limitation module consists of a set of lookup-tables that determine the maximum and minimum reactive power that can be supplied by the WT depending on active power and voltage. It can be used to implement the generator’s capability curve.</p>
<section id="parameters-1" class="level3" data-number="4.3.1">
<h3 data-number="4.3.1" class="anchored" data-anchor-id="parameters-1"><span class="header-section-number">4.3.1</span> Parameters</h3>
<div id="tbl-parametersWTQlim" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[10,6,5,20,44,15]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parametersWTQlim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;10: Parameters of Q limitation module, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span>
</figcaption>
<div aria-describedby="tbl-parametersWTQlim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 44%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">typical value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathbf{q_\mathrm{maxp}}(p)\)</span></td>
<td style="text-align: left;">lookup-table</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Maximum Q as a function of P</td>
<td style="text-align: left;">[0,0; 0.3,0.33; 1,0.33]</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathbf{q_\mathrm{maxu}}(u)\)</span></td>
<td style="text-align: left;">lookup-table</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Maximum Q as a function of U</td>
<td style="text-align: left;">[0,0; 0.8,0.33; 0.9,0.33]</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathbf{q_\mathrm{minp}}(p)\)</span></td>
<td style="text-align: left;">lookup-table</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Minimum Q as a function of P</td>
<td style="text-align: left;">[0,0; 0.3,-0.33; 1,-0.33]</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathbf{q_\mathrm{minu}}(u)\)</span></td>
<td style="text-align: left;">lookup-table</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Minimum Q as a function of U</td>
<td style="text-align: left;">[0,0; 0.8,-0.33; 0.9,-0.33]</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="variables-2" class="level3" data-number="4.3.2">
<h3 data-number="4.3.2" class="anchored" data-anchor-id="variables-2"><span class="header-section-number">4.3.2</span> Variables</h3>
<section id="inputs-2" class="level4" data-number="4.3.2.1">
<h4 data-number="4.3.2.1" class="anchored" data-anchor-id="inputs-2"><span class="header-section-number">4.3.2.1</span> Inputs</h4>
<div id="tbl-inputsWTQlim" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-inputsWTQlim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;11: Inputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-inputsWTQlim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 21%">
<col style="width: 7%">
<col style="width: 4%">
<col style="width: 18%">
<col style="width: 48%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(F_\mathrm{FRT}\)</span></td>
<td style="text-align: left;">boolean</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">WT Fault Ride Through (FRT) flag signal</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{WTCfilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Measured active power at the WT terminal</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{WTCfilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Measured voltage of the WT terminal</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outputs-2" class="level4" data-number="4.3.2.2">
<h4 data-number="4.3.2.2" class="anchored" data-anchor-id="outputs-2"><span class="header-section-number">4.3.2.2</span> Outputs</h4>
<div id="tbl-outputsWTQlim" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outputsWTQlim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;12: Outputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-outputsWTQlim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 28%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 23%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math display">\[q_\mathrm{WTmax}\]</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Maximum WT reactive power</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math display">\[q_\mathrm{WTmin}\]</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Minimum WT reactive power</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
</section>
<section id="current-limitation" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="current-limitation"><span class="header-section-number">4.4</span> Current limitation</h2>
<p>The current limitation acts after the P and Q controls as shown in <a href="#fig-wtControlSubstructure" class="quarto-xref">Figure&nbsp;2</a>. The priority between active and reactive current can be set by <span class="math inline">\(M_\mathrm{qpri}\)</span>. Outside FRT, P-Priority is always active regardless of <span class="math inline">\(M_\mathrm{qpri}\)</span>.</p>
<p>Current is limited to the maximum admissible current <span class="math inline">\(i_\mathrm{max}\)</span>. During FRT there is a separate maximum current value <span class="math inline">\(i_\mathrm{maxdip}\)</span>.</p>
<p>In addition to <span class="math inline">\(i_\mathrm{max}\)</span>, Voltage Dependent Limits (VDL) are defined for active and reactive current components through the look-up tables <span class="math inline">\(\mathbf{i_\mathrm{pmax}}(u_\mathrm{WT})\)</span> and <span class="math inline">\(\mathbf{i_\mathrm{qmax}}(u_\mathrm{WT})\)</span>.</p>
<p>The current limitation contains an additional high-voltage current limit logic (Kpqu-logic), which limits voltage-supporting reactive current injection when voltage is already high (parameters <span class="math inline">\(u_\mathrm{pqumax}\)</span>, <span class="math inline">\(K_\mathrm{pqu}\)</span>).</p>
<p>The following <a href="#fig-currentLimCode" class="quarto-xref">Figure&nbsp;9</a> shows a python inspired pseudo-code implementation of the the current limitation as shown in <span class="citation" data-cites="franke2024"><a href="#ref-franke2024" role="doc-biblioref">[8]</a></span>.</p>
<div id="fig-WTCurrentLim" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-WTCurrentLim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_CurrentLim.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-WTCurrentLim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Wind turbine current limitation, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<div id="fig-currentLimCode" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-currentLimCode-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<pre id="fig-currentLimCode"><code>M_DFSLim,imax_hook,iqmax_hook = (0,0,0)
if F_FRT == 1:
    i_maxset = i_maxdip
else: 
    i_maxset = i_max
# P Priority
if (M_qpri == 0) or (F_FRT == 0):
    i_pmax = i_pmaxVDL(u_WTCfilt)
    
    i_qlimit = min(
        i_qmaxVDL(u_WTCfilt),
        sqrt(max(0,
            i_maxset**2 - min(
                i_pcmd, 
                i_pmaxVDL(u_WTCfilt))**2) 
    ))
    i_qmin = -i_qlimit
    i_qmax = K_pqulogic(i_qlimit)
# Q Priority
else: 
    i_qlimit = i_qmaxVDL(u_WTCfilt)
    
    i_qmin = -i_qlimit
    i_qmax = K_pqulogic(i_qlimit)
    i_pmax = min(
        i_pmaxVDL(u_WTCfilt),
        sqrt(max(0,
            i_maxset**2 - min(
                abs(i_qcmd), 
                i_qmaxVDL(u_WTCfilt))**2)
    ))</code></pre>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-currentLimCode-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Python-inspired pseoudo code implementation of the current limitation block <span class="citation" data-cites="franke2024"><a href="#ref-franke2024" role="doc-biblioref">[8]</a></span>
</figcaption>
</figure>
</div>
<section id="parameters-2" class="level3" data-number="4.4.1">
<h3 data-number="4.4.1" class="anchored" data-anchor-id="parameters-2"><span class="header-section-number">4.4.1</span> Parameters</h3>
<div id="tbl-parametersCurrentLim" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[10,7,5,20,44,15]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parametersCurrentLim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;13: Parameters of current limitation module, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span>
</figcaption>
<div aria-describedby="tbl-parametersCurrentLim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 7%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 44%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">typical value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{max}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">WT terminal maximum admissible current</td>
<td style="text-align: left;">1.3</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{maxdip}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">WT terminal maximum admissible current during fault</td>
<td style="text-align: left;">1.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathbf{i_\mathrm{pmax}}(u_\mathrm{WT})\)</span></td>
<td style="text-align: left;">lookup-table</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">lookup-table for maximum active current as a function of voltage</td>
<td style="text-align: left;">[0,0; 0.1,0; 0.15,1; 0.9,1; 0.91,1.2; 1.2,1.2]</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathbf{i_\mathrm{qmax}}(u_\mathrm{WT})\)</span></td>
<td style="text-align: left;">lookup-table</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">lookup-table for maximum reactive current as a function of voltage</td>
<td style="text-align: left;">[0,0.1; 0.2,0.95; 0.2,1; 0.9,1; 0.9,0.36; 1.1,0.3]</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{pqu}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}/U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Droop of reactive current limit with resepect to voltage</td>
<td style="text-align: left;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(M_\mathrm{DFSLim}\)</span></td>
<td style="text-align: left;">boolean</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Type 3 stator current limitation (false = total current limitation, true = stator current limitation)</td>
<td style="text-align: left;">false</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(M_\mathrm{qpri}\)</span></td>
<td style="text-align: left;">boolean</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Active or reactive power priority during fault (false = active power priority, true = reactive power priority)</td>
<td style="text-align: left;">true</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{pqumax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Operation point of WT voltage where where no reactive current can be delivered</td>
<td style="text-align: left;">1.1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="variables-3" class="level3" data-number="4.4.2">
<h3 data-number="4.4.2" class="anchored" data-anchor-id="variables-3"><span class="header-section-number">4.4.2</span> Variables</h3>
<section id="inputs-3" class="level4" data-number="4.4.2.1">
<h4 data-number="4.4.2.1" class="anchored" data-anchor-id="inputs-3"><span class="header-section-number">4.4.2.1</span> Inputs</h4>
<div id="tbl-inputsCurrentLim" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-inputsCurrentLim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;14: Inputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-inputsCurrentLim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 21%">
<col style="width: 6%">
<col style="width: 3%">
<col style="width: 20%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(F_\mathrm{FRT}\)</span></td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">FRT signal</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{max\_hook}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">External offset value of maximum current module</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{pcmd}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">Active current command</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{qcmd}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">Reactive current command</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{qmax\_hook}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">External offset value of maximum reactive current</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\omega_\mathrm{gen}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_\mathrm{base}\)</span></td>
<td style="text-align: left;">Generator speed</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{WTCfilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Measured voltage</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outputs-3" class="level4" data-number="4.4.2.2">
<h4 data-number="4.4.2.2" class="anchored" data-anchor-id="outputs-3"><span class="header-section-number">4.4.2.2</span> Outputs</h4>
<div id="tbl-outputsCurrentLim" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outputsCurrentLim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;15: Outputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-outputsCurrentLim-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 23%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 23%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{pmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">Maximum active current limit</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{qmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">Maximum reactive current limit</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{qmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">Minimum reactive current limit</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
</section>
<section id="sec-mechanicalModule" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="sec-mechanicalModule"><span class="header-section-number">4.5</span> Mechanical module</h2>
<p>Two-mass model to represent drive train oscillations (mass oscillations between generator rotor and WT rotor).</p>
<div id="fig-mechanicalModule" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-mechanicalModule-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_mechanical.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mechanicalModule-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Wind turbine two mass mechanical module, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<section id="parameters-3" class="level3" data-number="4.5.1">
<h3 data-number="4.5.1" class="anchored" data-anchor-id="parameters-3"><span class="header-section-number">4.5.1</span> Parameters</h3>
<div id="tbl-parametersMechanical" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,44,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parametersMechanical-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;16: Parameters of mechanical moduele, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="tsourakis2009"><a href="#ref-tsourakis2009" role="doc-biblioref">[9]</a></span>
</figcaption>
<div aria-describedby="tbl-parametersMechanical-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 44%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">typical value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(c_\mathrm{drt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{base}/\Omega_\mathrm{base}\)</span></td>
<td style="text-align: left;">Damping of drive train</td>
<td style="text-align: left;">2.344</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(H_\mathrm{gen}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Inertia of generator rotor (inertial time constant)</td>
<td style="text-align: left;">3.395</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(H_\mathrm{WTR}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Inertia of WT rotor (inertial time constant)</td>
<td style="text-align: left;">0.962</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(k_\mathrm{drt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{base}\)</span></td>
<td style="text-align: left;">Stiffness of drive train</td>
<td style="text-align: left;">1.378</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="variables-4" class="level3" data-number="4.5.2">
<h3 data-number="4.5.2" class="anchored" data-anchor-id="variables-4"><span class="header-section-number">4.5.2</span> Variables</h3>
<section id="inputs-4" class="level4" data-number="4.5.2.1">
<h4 data-number="4.5.2.1" class="anchored" data-anchor-id="inputs-4"><span class="header-section-number">4.5.2.1</span> Inputs</h4>
<div id="tbl-inputsMechanical" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-inputsMechanical-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;17: Inputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-inputsMechanical-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 15%">
<col style="width: 59%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{aero}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Aerodynamic power (Power transferred from wind to WT rotor</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{ag}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Air gap power (power transferred from generator rotor to stator)</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outputs-4" class="level4" data-number="4.5.2.2">
<h4 data-number="4.5.2.2" class="anchored" data-anchor-id="outputs-4"><span class="header-section-number">4.5.2.2</span> Outputs</h4>
<div id="tbl-outputsMechanical" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outputsMechanical-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;18: Outputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-outputsMechanical-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 28%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\omega_\mathrm{gen}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_\mathrm{base}\)</span></td>
<td style="text-align: left;">generator rotor speed</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\omega_\mathrm{WTR}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_\mathrm{base}\)</span></td>
<td style="text-align: left;">Wind turbine rotor speed</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="initial-equations-2" class="level3" data-number="4.5.3">
<h3 data-number="4.5.3" class="anchored" data-anchor-id="initial-equations-2"><span class="header-section-number">4.5.3</span> Initial equations</h3>
<p>For the used initialization helper variables, see <a href="#sec-initHelpersGlobal" class="quarto-xref">Section&nbsp;7</a>.</p>
<p><span id="eq-initXwtr"><span class="math display">\[
x_\mathrm{WTR\,0} = x_\mathrm{gen\,0} = \omega_0
\tag{14}\]</span></span></p>
<p><span id="eq-initXdrt"><span class="math display">\[
x_\mathrm{drt\,0} = P_\mathrm{ag\,0} / \omega_0
\tag{15}\]</span></span></p>
</section>
</section>
<section id="sec-aerodynamic2d" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="sec-aerodynamic2d"><span class="header-section-number">4.6</span> Two-dimensional aerodynamic module</h2>
<p>The two-dimensional aerodynamic module is shown in <a href="#fig-wtAerodynamic" class="quarto-xref">Figure&nbsp;11</a>. <span class="math inline">\(\theta_0\)</span> represents the rated pitch angle (refers to the angle at which the turbine blades are positioned to achieve maximum power output at a specific wind speed).</p>
<div id="fig-wtAerodynamic" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wtAerodynamic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_aerodynamic.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wtAerodynamic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Wind turbine two-dimensional aerodynamic module (Type 3), based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<p>The rated pitch angle <span class="math inline">\(\theta_0\)</span> is subtracted from the actual wind turbine pitch angle <span class="math inline">\(\theta\)</span> to obtain <span class="math inline">\(\Delta\theta\)</span>. The pitch angle difference <span class="math inline">\(\Delta\theta\)</span> is then multiplied by <span class="math inline">\(\mathrm{d}p_{\theta}\)</span> to compute <span class="math inline">\(\Delta p_\mathrm{\theta}\)</span>, the change of aerodynamic power depending on the pitch angle change <span class="citation" data-cites="fortmann2014"><a href="#ref-fortmann2014" role="doc-biblioref">[3]</a></span>. <span class="math inline">\(\mathrm{d}p_{\theta}\)</span> is the the aerodynamic power partial derivative with respect to <span class="math inline">\(\theta\)</span>.</p>
<p><span class="math inline">\(\Delta p_\mathrm{\theta}\)</span> is typically negative because <span class="math inline">\(\mathrm{d}p_{\theta}&lt;0\)</span> and represents power redution because of pitch angle change. It is then added to the available power <span class="math inline">\(p_\mathrm{avail}\)</span>, which depends on wind speed.</p>
<p>To get the speed-dependent component <span class="math inline">\(\Delta p_\mathrm{\omega}\)</span>, first <span class="math inline">\(\Delta\omega\)</span> is calculated from the wind turbine’s reference speed <span class="math inline">\(\omega_\mathrm{0}\)</span> and the actual speed <span class="math inline">\(\omega_\mathrm{WTR}\)</span>. <span class="math inline">\(\Delta\omega\)</span> is then multiplied by <span class="math inline">\(\mathrm{d}p_\mathrm{\omega}\)</span>, the aerodynamic power partial derivative with respect to <span class="math inline">\(\omega\)</span>.</p>
<p><span class="math inline">\(\mathrm{d}p_\mathrm{\omega}\)</span> is itself dependent on the pitch angle <span class="math inline">\(\theta\)</span>, so it is calculated from <span class="math inline">\(\theta\)</span>, <span class="math inline">\(\mathrm{d}p_\mathrm{\omega\theta}\)</span> and <span class="math inline">\(\mathrm{d}p_\mathrm{\omega0}\)</span>, where <span class="math inline">\(\mathrm{d}p_\mathrm{\omega\theta}\)</span> is the pitch-dependency of <span class="math inline">\(\mathrm{d}p_\mathrm{\omega}\)</span>. <span class="math inline">\(\mathrm{d}p_{\omega0}\)</span> is the constant term of <span class="math inline">\(\mathrm{d}p_{\omega}\)</span> and depends on the wind speed.</p>
<p>The resulting change <span class="math inline">\(\Delta p_\mathrm{\omega}\)</span> of aerodynamic power depending on rotor speed is added to <span class="math inline">\(p_\mathrm{avail}\)</span> as well, resulting in the wind turbine aerodynamic power <span class="math inline">\(p_\mathrm{aero}\)</span> <span class="citation" data-cites="fortmann2014"><a href="#ref-fortmann2014" role="doc-biblioref">[3]</a></span>.</p>
<section id="parameters-4" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="parameters-4"><span class="header-section-number">4.6.1</span> Parameters</h3>
<p>Typical values were gathered from the <em>DIgSILENT PowerFactory</em> <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span> implementation of the model.</p>
<div id="tbl-parametersAero" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,20,44,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parametersAero-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;19: Parameters, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-parametersAero-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 41%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">modelica name</th>
<th style="text-align: left;">description</th>
<th style="text-align: right;">typical values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}p_\mathrm{\omega 0}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_{\mathrm{base}} / \Omega_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">DPOmega0Pu</td>
<td style="text-align: left;">Constant term of aerodynamic power partial derivative with respect to wind turbine rotor speed</td>
<td style="text-align: right;">0.48</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}p_\mathrm{\omega \theta}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_{\mathrm{base}} / \Omega_{\mathrm{base}} / \mathrm{deg}\)</span></td>
<td style="text-align: left;">DPOmegaThetaPu</td>
<td style="text-align: left;">Pitch dependency of aerodynamic power partial derivative with respect to wind turbine rotor speed</td>
<td style="text-align: right;">0.028</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}p_\mathrm{\theta}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_{\mathrm{base}} / \mathrm{deg}\)</span></td>
<td style="text-align: left;">DPThetaPu</td>
<td style="text-align: left;">Aerodynamic power partial derivative with respect to pitch angle (usually <span class="math inline">\(&lt;0\)</span>)</td>
<td style="text-align: right;">-0.03</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\omega_0\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">Omega0Pu</td>
<td style="text-align: left;">Rotor speed of the wind turbine, if not derated</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_{\mathrm{avail}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">PAvailPu</td>
<td style="text-align: left;">Available power; <span class="math inline">\(p_\mathrm{aero}\)</span> cannot be greater than <span class="math inline">\(p_\mathrm{avail}\)</span></td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\theta_0\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg</td>
<td style="text-align: left;">deg</td>
<td style="text-align: left;">Theta0</td>
<td style="text-align: left;">Pitch angle of the wind turbine in maximum available power operation</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>According to <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>, for <span class="math inline">\(0 &lt; p_\mathrm{avail} &lt; 1\)</span> the pitch angle should be zero. It should be greater than zero if <span class="math inline">\(p_\mathrm{avail} = 1\)</span> or if the initial value of <span class="math inline">\(p_\mathrm{aero}\)</span> is less than <span class="math inline">\(p_\mathrm{avail}\)</span>.</p>
</div>
</div>
</section>
<section id="variables-5" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="variables-5"><span class="header-section-number">4.6.2</span> Variables</h3>
<section id="inputs-5" class="level4" data-number="4.6.2.1">
<h4 data-number="4.6.2.1" class="anchored" data-anchor-id="inputs-5"><span class="header-section-number">4.6.2.1</span> Inputs</h4>
<div id="tbl-inputsAero" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,15,44]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-inputsAero-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;20: Inputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-inputsAero-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 15%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">modelica name</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\omega_\mathrm{WTR}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">omegaWTRPu</td>
<td style="text-align: left;">Wind Turbine Rotor speed</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\theta\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg</td>
<td style="text-align: left;">Deg</td>
<td style="text-align: left;">theta</td>
<td style="text-align: left;">Wind Turbine Pitch angle</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outputs-5" class="level4" data-number="4.6.2.2">
<h4 data-number="4.6.2.2" class="anchored" data-anchor-id="outputs-5"><span class="header-section-number">4.6.2.2</span> Outputs</h4>
<div id="tbl-outputsAero" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,10,44]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outputsAero-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;21: Outputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-outputsAero-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 10%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">modelica name</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{aero}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Deg</td>
<td style="text-align: left;">pAeroPu</td>
<td style="text-align: left;">Wind Turbine aerodynamic power</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
</section>
<section id="pitch-angle-control-module" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="pitch-angle-control-module"><span class="header-section-number">4.7</span> Pitch angle control module</h2>
<div id="fig-wtPitchAngleControl" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wtPitchAngleControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_pitch.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wtPitchAngleControl-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Wind turbine pitch angle module (Type 3), based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<p>The pitch angle control module is shown in <a href="#fig-wtPitchAngleControl" class="quarto-xref">Figure&nbsp;12</a>. It uses two PI controllers to control the pitch angle <span class="math inline">\(\theta\)</span>, one associated with rotor speed (<span class="math inline">\(K_\mathrm{I\omega}\)</span>, <span class="math inline">\(K_\mathrm{P\omega}\)</span>) and one with generator power (<span class="math inline">\(K_\mathrm{Ic}\)</span>, <span class="math inline">\(K_\mathrm{Pc}\)</span>) <span class="citation" data-cites="honrubia-escribano2018"><a href="#ref-honrubia-escribano2018" role="doc-biblioref">[2]</a></span>.</p>
<p>The outputs of both PI controllers are pitch angle setpoints (<span class="math inline">\(\theta_\mathrm{\omega}\)</span> and <span class="math inline">\(\theta_\mathrm{c}\)</span>). They are kept inside their respective limits (<span class="math inline">\(\theta_\mathrm{\omega min|max}\)</span> and <span class="math inline">\(\theta_\mathrm{cmin|max}\)</span>), similarly for the pitch angles’ rates of change.</p>
<p>The rotor speed and power integrators are anti-windup, which means that the integrator is blocked when the lower or upper limit of <span class="math inline">\(\theta\)</span> are reached, until the error input changes direction. Both controller outputs are added before a low-pass filter (time constant <span class="math inline">\(T_\theta\)</span>) is applied. The filter with limitation detection considers the pitch angle limitation <span class="math inline">\(\theta_\mathrm{min|max}\)</span> and pitch angle rate of change <span class="math inline">\(\mathrm{d}\theta_{\mathrm{min|max}}\)</span>.</p>
<p>The pitch angle rate of change plays a crucial role during power system faults since it avoids overspeeding during faults by controlling how fast the aerodynamic power is reduced <span class="citation" data-cites="honrubia-escribano2018"><a href="#ref-honrubia-escribano2018" role="doc-biblioref">[2]</a></span>.</p>
<p>Since a Doubly-Fed Induction Generator (DFIG) turbine is already operating at rated rotor speed before reaching nominal wind speed, under certain conditions, the pitch (<span class="math inline">\(\theta\)</span> &gt; 0) could be activated even though the generated active power is lower than 1 pu. Therefore, the cross-coupling gain <span class="math inline">\(K_\mathrm{PX}\)</span> is used to modify the signal introduced into the rotor speed error <span class="citation" data-cites="honrubia-escribano2018"><a href="#ref-honrubia-escribano2018" role="doc-biblioref">[2]</a></span>.</p>
<section id="parameters-5" class="level3" data-number="4.7.1">
<h3 data-number="4.7.1" class="anchored" data-anchor-id="parameters-5"><span class="header-section-number">4.7.1</span> Parameters</h3>
<p>Typical values were gathered from the <em>DIgSILENT PowerFactory</em> <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span> implementation of the model.</p>
<div id="tbl-parametersPitch" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,17,20,44,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parametersPitch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;22: Parameters, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-parametersPitch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 16%">
<col style="width: 19%">
<col style="width: 42%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">modelica name</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">typical values</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}\theta_{\mathrm{cmax}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg/s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">DThetaCmax</td>
<td style="text-align: left;">Pitch maximum positive ramp rate of power PI controller</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}\theta_{\mathrm{cmin}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg/s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">DThetaCmin</td>
<td style="text-align: left;">Pitch minimum positive ramp rate of power PI controllerr</td>
<td style="text-align: left;">-3</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}\theta_{\mathrm{max}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg/s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">DThetaMax</td>
<td style="text-align: left;">Pitch maximum positive ramp rate</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}\theta_{\mathrm{min}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg/s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">DThetaMin</td>
<td style="text-align: left;">Pitch maximum negative ramp rate</td>
<td style="text-align: left;">-3</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}\theta_{\omega\mathrm{max}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg/s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">DThetaOmegamax</td>
<td style="text-align: left;">Pitch maximum positive ramp rate of speed PI controller</td>
<td style="text-align: left;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}\theta_{\omega\mathrm{min}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg/s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">DThetaOmegamin</td>
<td style="text-align: left;">Pitch maximum negative ramp rate of speed PI controller</td>
<td style="text-align: left;">-3</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{Ic}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\mathrm{deg} / S_{\mathrm{base}} / \mathrm{s}\)</span></td>
<td style="text-align: left;">KIcPu</td>
<td style="text-align: left;">Integration gain of power PI controller</td>
<td style="text-align: left;">0.0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{I\omega}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\mathrm{deg} / \Omega_{\mathrm{base}} / \mathrm{s}\)</span></td>
<td style="text-align: left;">KIOmegaPu</td>
<td style="text-align: left;">Integration gain of speed PI controller</td>
<td style="text-align: left;">15</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{Pc}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\mathrm{deg} / S_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">KPcPu</td>
<td style="text-align: left;">Proportional gain of power PI controller</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{P\omega}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\mathrm{deg} / \Omega_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">KPomegaPu</td>
<td style="text-align: left;">Proportional gain of speed PI controller</td>
<td style="text-align: left;">15</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{PX}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_{\mathrm{base}} / S_{\mathrm{base}}\)</span></td>
<td style="text-align: left;">KPXPu</td>
<td style="text-align: left;">Cross coupling pitch gain</td>
<td style="text-align: left;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\theta_\mathrm{cmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">ThetaCmax</td>
<td style="text-align: left;">Maximum WT pitch angle of power PI controller</td>
<td style="text-align: left;">35</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\theta_\mathrm{cmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">ThetaCmin</td>
<td style="text-align: left;">Minimum WT pitch angle of power PI controller</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\theta_\mathrm{max}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">ThetaMax</td>
<td style="text-align: left;">Maximum WT pitch angle</td>
<td style="text-align: left;">35</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\theta_\mathrm{min}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">ThetaMin</td>
<td style="text-align: left;">Minimum WT pitch angle</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\theta_\mathrm{\omega max}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">ThetaOmegamax</td>
<td style="text-align: left;">Maximum WT pitch angle of speed PI controller</td>
<td style="text-align: left;">35</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\theta_\mathrm{\omega min}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">ThetaOmegamin</td>
<td style="text-align: left;">Minimum WT pitch angle of speed PI controller</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(T_\theta\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">TTheta</td>
<td style="text-align: left;">WT pitch time constant</td>
<td style="text-align: left;">0.25</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<section id="variables-6" class="level4" data-number="4.7.1.1">
<h4 data-number="4.7.1.1" class="anchored" data-anchor-id="variables-6"><span class="header-section-number">4.7.1.1</span> Variables</h4>
<section id="inputs-6" class="level5" data-number="4.7.1.1.1">
<h5 data-number="4.7.1.1.1" class="anchored" data-anchor-id="inputs-6"><span class="header-section-number">4.7.1.1.1</span> Inputs</h5>
<div id="tbl-inputsPitch" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,7,15,44]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-inputsPitch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;23: Inputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-inputsPitch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 15%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">modelica name</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\omega_\mathrm{ref}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_\mathrm{base}\)</span></td>
<td style="text-align: left;">omegaRefPu</td>
<td style="text-align: left;">Wind Turbine rotor speed reference</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\omega_\mathrm{WTR}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_\mathrm{base}\)</span></td>
<td style="text-align: left;">omegaWTRPu</td>
<td style="text-align: left;">Wind Turbine rotor speed</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{ord}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">pOrdPu</td>
<td style="text-align: left;">Wind Turbine active power</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{WTref}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">pWTrefPu</td>
<td style="text-align: left;">Wind Turbine active power reference</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outputs-6" class="level5" data-number="4.7.1.1.2">
<h5 data-number="4.7.1.1.2" class="anchored" data-anchor-id="outputs-6"><span class="header-section-number">4.7.1.1.2</span> Outputs</h5>
<div id="tbl-outputsPitch" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,10,44]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outputsPitch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;24: Outputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-outputsPitch-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 10%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">modelica name</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\theta\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">deg</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">theta</td>
<td style="text-align: left;">Wind Turbine pitch angle</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
</section>
<section id="initial-equations-3" class="level3" data-number="4.7.2">
<h3 data-number="4.7.2" class="anchored" data-anchor-id="initial-equations-3"><span class="header-section-number">4.7.2</span> Initial equations</h3>
<p>For the used initialization helper variables, see <a href="#sec-initHelpersGlobal" class="quarto-xref">Section&nbsp;7</a>.</p>
<p>For the used parameters of the aerodynamic module, see <a href="#sec-aerodynamic2d" class="quarto-xref">Section&nbsp;4.6</a></p>
<p><span id="eq-initIomega"><span class="math display">\[
x_\mathrm{I\omega} = x_\mathrm{\theta \omega} = x_\mathrm{\theta} = \theta_0 + (P_\mathrm{ag\,0}-p_\mathrm{avail})/\mathrm{d}p_\mathrm{\theta}
\tag{16}\]</span></span></p>
<p><span id="eq-initIc"><span class="math display">\[
x_\mathrm{Ic} = x_\mathrm{\theta c} = 0
\tag{17}\]</span></span></p>
<!-- 
$$
\theta = \frac{p_\mathrm{Aero}-p_\mathrm{Avail}-\theta_\mathrm{0}*dp_{\theta}-dp_\mathrm{\omega0}*(\omega_\mathrm{WTR}+\omega_0)}{dp_\theta+dp_\omega\theta*(\omega_\mathrm{WTR}+\omega_\mathrm{0})}
$$ {#eq-initTheta} 
-->
</section>
</section>
<section id="generator-system-type-3" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="generator-system-type-3"><span class="header-section-number">4.8</span> Generator system type 3</h2>
<section id="description" class="level3" data-number="4.8.1">
<h3 data-number="4.8.1" class="anchored" data-anchor-id="description"><span class="header-section-number">4.8.1</span> Description</h3>
<p>Two different models (3A and 3B) have been definded in the IEC <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>, depending on the FRT solution implemented for the WT.</p>
<p>FRT implies large currents in the rotor and large power injected into the DC circuit of the converter <span class="citation" data-cites="honrubia-escribano2018"><a href="#ref-honrubia-escribano2018" role="doc-biblioref">[2]</a></span>. Rotor and converter protection against high currents and voltages is realized by a DC chopper and/or an AC crowbar circuit.</p>
<p><strong>A DC chopper</strong> basically keeps the DC voltage constant by dissipating energy through a switched resistor. This implies controllability of the rotor by the converter during FRT.</p>
<p><strong>A crowbar circuit</strong> consists of switchable resistances between the rotor’s phases. In case of undesirably high currents in the machine rotor or high DC voltages, the crowbar switches are closed and the rotor’s windings short-circuited through the crowbar resistances. This way, overcurrents and -voltages are prevented but there is no control action by the converter on the rotor windings anymore and the generator acts like a conventional slip-ring induction machine (Type 1 machine) <span class="citation" data-cites="fortmann2014a"><a href="#ref-fortmann2014a" role="doc-biblioref">[4]</a></span>. This leads to a delay on the delivery of voltage control functionality as well as active and reactive power transients after fault inception and fault clearance <span class="citation" data-cites="honrubia-escribano2018"><a href="#ref-honrubia-escribano2018" role="doc-biblioref">[2]</a></span>.</p>
<section id="type-3a" class="level4" data-number="4.8.1.1">
<h4 data-number="4.8.1.1" class="anchored" data-anchor-id="type-3a"><span class="header-section-number">4.8.1.1</span> Type 3A</h4>
<div id="fig-generatorType3a" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-generatorType3a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_GS_3A.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-generatorType3a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Wind turbine type 3A generator system model, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<p>The Type 3A Generator System represents a DFIG. Inside the WT controls, <span class="math inline">\(i_\mathrm{p}\)</span> and <span class="math inline">\(i_\mathrm{q}\)</span> represent active and reactive current components. On the grid side (gs), after the reference frame rotation, this is not the case, because the voltage angle is different. Hence, the PI current controller’s output as well as the feedback of the generator system’s current need to be rotated in either direction to match the respective reference frames.</p>
<p>Because the stator is directly coupled to the grid in case of a DFIG, an abrupt voltage variation will cause a change in the reactive power flow. The addition/subtraction of <span class="math inline">\(u / x_\mathrm{eqv}\)</span> is added to simulate these electromagnetic transients (related to rotor flux derivative) <span class="citation" data-cites="honrubia-escribano2018"><a href="#ref-honrubia-escribano2018" role="doc-biblioref">[2]</a></span> <span class="citation" data-cites="lorenzo-bonache2019"><a href="#ref-lorenzo-bonache2019" role="doc-biblioref">[6]</a></span>.</p>
<p>The air-gap power <span class="math inline">\(p_\mathrm{ag}\)</span> is an additional output of the model, which is used as an input for the mechanical model in <a href="#fig-mechanicalModule" class="quarto-xref">Figure&nbsp;10</a>.</p>
<p>In this model a DC chopper is assumed. The model is not applicable for older DFIG systems that require a crowbar during grid faults (<span class="citation" data-cites="fortmann2014"><a href="#ref-fortmann2014" role="doc-biblioref">[3]</a></span>, p.&nbsp;111).</p>
</section>
<section id="type-3b" class="level4" data-number="4.8.1.2">
<h4 data-number="4.8.1.2" class="anchored" data-anchor-id="type-3b"><span class="header-section-number">4.8.1.2</span> Type 3B</h4>
<div id="fig-generatorType3b" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-generatorType3b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_GS_3B.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-generatorType3b-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Wind turbine type 3B generator system model, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<p>The Type 3B Generator System models a DFIG with crowbar circuit.</p>
<p>In the model, as shown in <a href="#fig-generatorType3b" class="quarto-xref">Figure&nbsp;14</a>, the crowbar system is not physically modeled but instead represented by multiplying the current commands by zero for a certain period of time when the voltage module’s derivative goes beyond a certain threshold <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span>.</p>
<div>

</div>
<div class="quarto-layout-panel" data-layout-ncol="2">
<div class="quarto-layout-row">
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-generatorType3bRisingDetection" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-generatorType3bRisingDetection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_GS_3B_risingvalue.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-generatorType3bRisingDetection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: Rising value detection, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
</div>
<div class="quarto-layout-cell" style="flex-basis: 50.0%;justify-content: flex-start;">
<div id="fig-generatorType3bTimer" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-generatorType3bTimer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WT_GS_3B_timer.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-generatorType3bTimer-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;16: Timer, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="paramaters" class="level3" data-number="4.8.2">
<h3 data-number="4.8.2" class="anchored" data-anchor-id="paramaters"><span class="header-section-number">4.8.2</span> Paramaters</h3>
<section id="type-3a-1" class="level4" data-number="4.8.2.1">
<h4 data-number="4.8.2.1" class="anchored" data-anchor-id="type-3a-1"><span class="header-section-number">4.8.2.1</span> Type 3A</h4>
<div id="tbl-parametersGenSys3a" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,10,44,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parametersGenSys3a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;25: Parameters of Type 3A Generator System, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span>
</figcaption>
<div aria-describedby="tbl-parametersGenSys3a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 10%">
<col style="width: 44%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">modelica name</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">typical value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}i_\mathrm{pmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu/s</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">DIPMax</td>
<td style="text-align: left;">Active current ramp rate limit</td>
<td style="text-align: left;">9999</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}i_\mathrm{qmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu/s</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">DIQMax</td>
<td style="text-align: left;">Reactive current ramp rate limit</td>
<td style="text-align: left;">9999</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{Pc}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">KPc</td>
<td style="text-align: left;">Proportional gain of current controller</td>
<td style="text-align: left;">40</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{Ic}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">TIc</td>
<td style="text-align: left;">Integral gain of current controller</td>
<td style="text-align: left;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{eqv}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(Z_\mathrm{base}\)</span></td>
<td style="text-align: left;">XEqv</td>
<td style="text-align: left;">Transient reactance (calculated from transient inductance like in <span class="citation" data-cites="fortmann2014a"><a href="#ref-fortmann2014a" role="doc-biblioref">[4]</a></span>)</td>
<td style="text-align: left;">0.4</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="type-3b-1" class="level4" data-number="4.8.2.2">
<h4 data-number="4.8.2.2" class="anchored" data-anchor-id="type-3b-1"><span class="header-section-number">4.8.2.2</span> Type 3B</h4>
<div id="tbl-parametersGenSys3a" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,10,44,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parametersGenSys3a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;26: Parameters of Type 3B Generator System, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span>
</figcaption>
<div aria-describedby="tbl-parametersGenSys3a-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 10%">
<col style="width: 44%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">modelica name</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">typical value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}i_\mathrm{pmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu/s</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">DIPMax</td>
<td style="text-align: left;">Active current ramp rate limit</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}i_\mathrm{qmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu/s</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">DIQMax</td>
<td style="text-align: left;">Reactive current ramp rate limit</td>
<td style="text-align: left;">100</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(M_\mathrm{CRB}\)</span></td>
<td style="text-align: left;">boolean</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">KPc</td>
<td style="text-align: left;">Control mode</td>
<td style="text-align: left;">false</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathbf{T_\mathrm{CRB}}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">tCrb</td>
<td style="text-align: left;">look-up table: Crowbar duration (output) as a function of voltage variation (input)</td>
<td style="text-align: left;">[-99,0.1; -1,0.1; -0.1,0; 0,0]</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{g}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">TG</td>
<td style="text-align: left;">Time constant of current generation</td>
<td style="text-align: left;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{wo}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">TWo</td>
<td style="text-align: left;">Crowbar washout filter time constant</td>
<td style="text-align: left;">0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{eqv}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(Z_\mathrm{base}\)</span></td>
<td style="text-align: left;">XEqv</td>
<td style="text-align: left;">Transient reactance (calculated from transient inductance like in <span class="citation" data-cites="fortmann2014a"><a href="#ref-fortmann2014a" role="doc-biblioref">[4]</a></span>)</td>
<td style="text-align: left;">10</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="variables-7" class="level3" data-number="4.8.3">
<h3 data-number="4.8.3" class="anchored" data-anchor-id="variables-7"><span class="header-section-number">4.8.3</span> Variables</h3>
<section id="inputs-7" class="level4" data-number="4.8.3.1">
<h4 data-number="4.8.3.1" class="anchored" data-anchor-id="inputs-7"><span class="header-section-number">4.8.3.1</span> Inputs</h4>
<div id="tbl-inputsGensys" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,10,44,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-inputsGensys-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;27: Inputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="lorenzo-bonache2017"><a href="#ref-lorenzo-bonache2017" role="doc-biblioref">[5]</a></span>
</figcaption>
<div aria-describedby="tbl-inputsGensys-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 10%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">modelica name</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{pcmd}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">ipCmdPu</td>
<td style="text-align: left;">Active current command</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{pmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">ipMaxPu</td>
<td style="text-align: left;">Maximum active current</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{qcmd}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">iqCmdPu</td>
<td style="text-align: left;">Reactive current command</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{qmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">iqMaxPu</td>
<td style="text-align: left;">Maximum reactive current</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{qmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">iqMinPu</td>
<td style="text-align: left;">Minimum reactive current</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\underline{u}_\mathrm{gs}\)</span></td>
<td style="text-align: left;">complex</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">terminal.V</td>
<td style="text-align: left;">Generator system terminal voltage</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outputs-7" class="level4" data-number="4.8.3.2">
<h4 data-number="4.8.3.2" class="anchored" data-anchor-id="outputs-7"><span class="header-section-number">4.8.3.2</span> Outputs</h4>
<div id="tbl-outputsGensys" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,10,44,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outputsGensys-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;28: Outputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-outputsGensys-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 10%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">modelica name</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{ag}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">PAgPu</td>
<td style="text-align: left;">Air gap power (before losses due to connection impedance and admittance)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\underline{i}_\mathrm{gs}\)</span></td>
<td style="text-align: left;">complex</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">terminal.i</td>
<td style="text-align: left;">Generator system terminal current</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="initial-equations-4" class="level3" data-number="4.8.4">
<h3 data-number="4.8.4" class="anchored" data-anchor-id="initial-equations-4"><span class="header-section-number">4.8.4</span> Initial equations</h3>
<p>For the used initialization helper variables, see <a href="#sec-initHelpersGlobal" class="quarto-xref">Section&nbsp;7</a>.</p>
<p><span id="eq-initXip"><span class="math display">\[
x_\mathrm{Ip} = P_\mathrm{ord\,0}/U_0
\tag{18}\]</span></span></p>
<p><span id="eq-initXiq"><span class="math display">\[
x_\mathrm{Iq} = Q_\mathrm{ord\,0}/U_0
\tag{19}\]</span></span></p>
<p><span id="eq-initXpip"><span class="math display">\[
x_\mathrm{PIp} = x_\mathrm{PIq} = 0
\tag{20}\]</span></span></p>
<p><span id="eq-initXintp"><span class="math display">\[
x_\mathrm{intp} = I_\mathrm{gs\,re\,0} + \frac{U_\mathrm{gs\,im\,0}}{X_\mathrm{eqv}}
\tag{21}\]</span></span></p>
<p><span id="eq-initXintq"><span class="math display">\[
x_\mathrm{intq} = I_\mathrm{gs\,im\,0} - \frac{U_\mathrm{gs\,re\,0}}{X_\mathrm{eqv}}
\tag{22}\]</span></span></p>
<p><span id="eq-initXtgp"><span class="math display">\[
x_\mathrm{Tgp} = I_\mathrm{gs\,re\,0} + \frac{U_\mathrm{gs\,im\,0}}{X_\mathrm{eqv}}
\tag{23}\]</span></span></p>
<p><span id="eq-initXtgq"><span class="math display">\[
x_\mathrm{Tgq} = I_\mathrm{gs\,im\,0} - \frac{U_\mathrm{gs\,re\,0}}{X_\mathrm{eqv}}
\tag{24}\]</span></span></p>
<p><span id="eq-initXwo"><span class="math display">\[
x_\mathrm{wo} = 0
\tag{25}\]</span></span></p>
</section>
<section id="assumptions-in-modelica-implementation" class="level3" data-number="4.8.5">
<h3 data-number="4.8.5" class="anchored" data-anchor-id="assumptions-in-modelica-implementation"><span class="header-section-number">4.8.5</span> Assumptions in Modelica implementation</h3>
</section>
</section>
<section id="grid-measurement-module" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="grid-measurement-module"><span class="header-section-number">4.9</span> Grid measurement module</h2>
<p>Calculates measured values from complex grid voltage and current and grid frequency.</p>
<div id="fig-measurementModule" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-measurementModule-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/IEC_WT_meas.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-measurementModule-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Grid measurement module, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<section id="parameters-6" class="level3" data-number="4.9.1">
<h3 data-number="4.9.1" class="anchored" data-anchor-id="parameters-6"><span class="header-section-number">4.9.1</span> Parameters</h3>
<div id="tbl-parametersMeasurement" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,44,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parametersMeasurement-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;29: Parameters of measurement module, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span>
</figcaption>
<div aria-describedby="tbl-parametersMeasurement-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 44%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">typical value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}\Phi_\mathrm{max}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(f_\mathrm{n}/\mathrm{s}\)</span></td>
<td style="text-align: left;">Max. rate of change of frequency, should be larger than any ROCOF protection threshold in the system.</td>
<td style="text-align: left;">0.1 (5 Hz/s)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{ffilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">frequency measurement fitler time constant</td>
<td style="text-align: left;">0.005</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{ifilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">current measurement fitler time constant</td>
<td style="text-align: left;">0.005</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{pfilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">active power measurement fitler time constant</td>
<td style="text-align: left;">0.005</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{qfilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">reactive power measurement fitler time constant</td>
<td style="text-align: left;">0.005</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{ufilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">voltage measurement fitler time constant</td>
<td style="text-align: left;">0.005</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="variables-8" class="level3" data-number="4.9.2">
<h3 data-number="4.9.2" class="anchored" data-anchor-id="variables-8"><span class="header-section-number">4.9.2</span> Variables</h3>
<section id="inputs-8" class="level4" data-number="4.9.2.1">
<h4 data-number="4.9.2.1" class="anchored" data-anchor-id="inputs-8"><span class="header-section-number">4.9.2.1</span> Inputs</h4>
<div id="tbl-inputsMeasurement" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-inputsMeasurement-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;30: Inputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-inputsMeasurement-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 8%">
<col style="width: 4%">
<col style="width: 25%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(f_\mathrm{sys}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_\mathrm{base}\)</span></td>
<td style="text-align: left;">grid frequency of global power system</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\underline{i}\)</span></td>
<td style="text-align: left;">complex</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">measured current</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\underline{u}\)</span></td>
<td style="text-align: left;">complex</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">measured voltage</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outputs-8" class="level4" data-number="4.9.2.2">
<h4 data-number="4.9.2.2" class="anchored" data-anchor-id="outputs-8"><span class="header-section-number">4.9.2.2</span> Outputs</h4>
<div id="tbl-outputsMeasurement" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outputsMeasurement-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;31: Outputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-outputsMeasurement-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 21%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 21%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(f_\mathrm{filt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_\mathrm{base}\)</span></td>
<td style="text-align: left;">frequency with measurement delay</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(i_\mathrm{filt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(I_\mathrm{base}\)</span></td>
<td style="text-align: left;">current with measurement delay</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{filt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">active power with measurement delay</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(q_\mathrm{filt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">reactive power with measurement delay</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(u\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">voltage without measurement delay</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{filt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">voltage with measurement delay</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="initial-equations-5" class="level3" data-number="4.9.3">
<h3 data-number="4.9.3" class="anchored" data-anchor-id="initial-equations-5"><span class="header-section-number">4.9.3</span> Initial equations</h3>
<p>For the used initialization helper variables, see <a href="#sec-initHelpersGlobal" class="quarto-xref">Section&nbsp;7</a>.</p>
<p><span id="eq-initXmeasp"><span class="math display">\[
x_\mathrm{meas\,p} = P_0
\tag{26}\]</span></span></p>
<p><span id="eq-initXmeasq"><span class="math display">\[
x_\mathrm{meas\,q} = Q_0
\tag{27}\]</span></span></p>
<p><span id="eq-initXmeasi"><span class="math display">\[
x_\mathrm{meas\,i} = \frac{\sqrt{P_0^2 + Q_0^2}}{U_0}
\tag{28}\]</span></span></p>
<p><span id="eq-initXmeasu"><span class="math display">\[
x_\mathrm{meas\,u} = U_0
\tag{29}\]</span></span></p>
<p><span id="eq-initXmeasf"><span class="math display">\[
x_\mathrm{meas\,f} = x_\mathrm{meas\,df} = 0
\tag{30}\]</span></span></p>
</section>
</section>
<section id="protection-module" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="protection-module"><span class="header-section-number">4.10</span> Protection module</h2>
<p>The grid protection module offers protection against both over-voltage and under-voltage, as well as over-frequency and under-frequency conditions. As desribed in <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>, this time-based grid protection has specific ranges of protection levels along with associated disconnection times.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="drawings/Grid_Protection.drawio.svg" class="img-fluid figure-img"></p>
<figcaption>Grid protecton system module, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> (timer: see <a href="#fig-generatorType3bTimer" class="quarto-xref">Figure&nbsp;16</a>)</figcaption>
</figure>
</div>
<section id="parameters-7" class="level3" data-number="4.10.1">
<h3 data-number="4.10.1" class="anchored" data-anchor-id="parameters-7"><span class="header-section-number">4.10.1</span> Parameters</h3>
<div id="tbl-parametersProtection" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,44,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parametersProtection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;32: Parameters of measurement module, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span>
</figcaption>
<div aria-describedby="tbl-parametersProtection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 44%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">typical value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(f_\mathrm{over}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(f_\mathrm{n}\)</span></td>
<td style="text-align: left;">over frequency protection threshold of WT</td>
<td style="text-align: left;">1.02</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(f_\mathrm{under}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(f_\mathrm{n}\)</span></td>
<td style="text-align: left;">under frequency protection threshold of WT</td>
<td style="text-align: left;">0.98</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathbf{T_\mathrm{fover}}(f_\mathrm{WT})\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">lookup-table: disconnection time as a function of over frequency</td>
<td style="text-align: left;">[1.02,1800; 1.03,1800; 1.03,0.1]</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathbf{T_\mathrm{funder}}(f_\mathrm{WT})\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">lookup-table: disconnection time as a function of under frequency</td>
<td style="text-align: left;">[0.95,0.1; 0.95,1800; 0.98,1800]</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathbf{T_\mathrm{uover}}(u_\mathrm{WT})\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">lookup-table: disconnection time as a function of over voltage</td>
<td style="text-align: left;">[1.2,60; 1.2,0.1; 1.3,0.1]</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathbf{T_\mathrm{uunder}}(u_\mathrm{WT})\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">lookup-table: disconnection time as a function of under voltage</td>
<td style="text-align: left;">[0,0.15; 0.85,3]</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{over}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">over voltage protection threshold of WT</td>
<td style="text-align: left;">1.2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{under}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">under voltage protection threshold of WT</td>
<td style="text-align: left;">0.85</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="variables-9" class="level3" data-number="4.10.2">
<h3 data-number="4.10.2" class="anchored" data-anchor-id="variables-9"><span class="header-section-number">4.10.2</span> Variables</h3>
<section id="inputs-9" class="level4" data-number="4.10.2.1">
<h4 data-number="4.10.2.1" class="anchored" data-anchor-id="inputs-9"><span class="header-section-number">4.10.2.1</span> Inputs</h4>
<div id="tbl-inputsProtection" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-inputsProtection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;33: Inputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-inputsProtection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 26%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(f_\mathrm{WTPfilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(\Omega_\mathrm{base}\)</span></td>
<td style="text-align: left;">Measured frequency of wind plant</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{WTPfilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Measured voltage of wind plant</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outputs-9" class="level4" data-number="4.10.2.2">
<h4 data-number="4.10.2.2" class="anchored" data-anchor-id="outputs-9"><span class="header-section-number">4.10.2.2</span> Outputs</h4>
<div id="tbl-outputsProtection" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outputsProtection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;34: Outputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-outputsProtection-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 10%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 53%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(F_\mathrm{OCB}\)</span></td>
<td style="text-align: left;">boolean</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Flag-signal to open circuit breaker</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
</section>
</section>
<section id="wind-power-plant-model" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Wind power plant model</h1>
<div id="fig-wp" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WP_control_and_communication.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wp-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;18: Wind plant control and communictaion, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<p>The Wind Plant (WP) model includes two controllers: active power / frequency controller (<a href="#fig-wpActivePower" class="quarto-xref">Figure&nbsp;19</a>) and and reactive power / voltage control (<a href="#fig-wpReactivePower" class="quarto-xref">Figure&nbsp;20</a>).</p>
<p>Both, the P and Q controllers, freeze their state variables during FRT.</p>
<p>The WP model controls one single Point of Common Coupling (PCC). According to <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> it is normally enough to use a single aggregated model for all WTs in a WP. Still, also large WP can be modeled by using multiple WT models which all get the same reference values from the WP controller.</p>
<section id="wp-p-control" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="wp-p-control"><span class="header-section-number">5.1</span> WP P Control</h2>
<div id="fig-wpActivePower" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wpActivePower-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WP_P.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wpActivePower-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;19: WPP P control module, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<p>The active power controller controls P as a function of frequency or external reference changes <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>.</p>
<section id="parameters-8" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="parameters-8"><span class="header-section-number">5.1.1</span> Parameters</h3>
<div id="tbl-parametersWPP" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[15,8,5,10,44,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parametersWPP-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;35: Parameters of WP P control, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span>
</figcaption>
<div aria-describedby="tbl-parametersWPP-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 8%">
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 44%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">typical value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}p_\mathrm{refmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu/s</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Positive ramp rate limit of active power reference</td>
<td style="text-align: left;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}p_\mathrm{refmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu/s</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Negative ramp rate limit of active power reference</td>
<td style="text-align: left;">-0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}p_\mathrm{WPrefmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu/s</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Positive ramp rate limit for power reference</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}p_\mathrm{WPrefmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu/s</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Negative ramp rate limit for power reference</td>
<td style="text-align: left;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{IWPp}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">1/s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">PI controller integrator gain</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{PWPp}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">PI controller proportional gain</td>
<td style="text-align: left;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{WPpref}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Gain of power reference</td>
<td style="text-align: left;">0.5</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{errmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">PI controller maximum control error</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{errmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">PI controller minimum control error</td>
<td style="text-align: left;">-1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{KIWPpmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">PI controller integrator upper limit</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{KIWPpmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">PI controller integrator lower limit</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{refmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Upper limit of active power reference</td>
<td style="text-align: left;">1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{refmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Lower limit of active power reference</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathbf{p_\mathrm{WPbias}}(f)\)</span></td>
<td style="text-align: left;">lookup-table</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Power variation as a function of frequency (lookup-table)</td>
<td style="text-align: left;">[0,0; 1,0; 1.004,0; 1.104,-1]</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="variables-10" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="variables-10"><span class="header-section-number">5.1.2</span> Variables</h3>
<section id="inputs-10" class="level4" data-number="5.1.2.1">
<h4 data-number="5.1.2.1" class="anchored" data-anchor-id="inputs-10"><span class="header-section-number">5.1.2.1</span> Inputs</h4>
<div id="tbl-inputsWPP" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-inputsWPP-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;36: Inputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-inputsWPP-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 19%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(f_\mathrm{WPfiltCom}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(f_\mathrm{n}\)</span></td>
<td style="text-align: left;">Measured frequency</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(F_\mathrm{WPfiltCom}\)</span></td>
<td style="text-align: left;">boolean</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">WP FRT signal</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{WPfiltCom}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{n}\)</span></td>
<td style="text-align: left;">Measured active power</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{WPhook}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">External active power reference offset</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{WPrefCom}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Active power WP reference value</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outputs-10" class="level4" data-number="5.1.2.2">
<h4 data-number="5.1.2.2" class="anchored" data-anchor-id="outputs-10"><span class="header-section-number">5.1.2.2</span> Outputs</h4>
<div id="tbl-outputsWPP" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outputsWPP-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;37: Outputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-outputsWPP-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 24%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 22%">
<col style="width: 41%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{PDref}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Power Device (PD) active power reference</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="initial-equations-6" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="initial-equations-6"><span class="header-section-number">5.1.3</span> Initial equations</h3>
<p>For the used initialization helper variables, see <a href="#sec-initHelpersGlobal" class="quarto-xref">Section&nbsp;7</a>.</p>
<p><span id="eq-initXwppref"><span class="math display">\[
x_\mathrm{WPPref} = P_\mathrm{WTRef\,0}
\tag{31}\]</span></span></p>
<p><span id="eq-initXwpip"><span class="math display">\[
x_\mathrm{WPIp} = (1-K_\mathrm{WppRef})P_\mathrm{WTRef\,0}
\tag{32}\]</span></span></p>
</section>
</section>
<section id="wp-q-control" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="wp-q-control"><span class="header-section-number">5.2</span> WP Q Control</h2>
<div id="fig-wpReactivePower" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wpReactivePower-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WP_Q.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wpReactivePower-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;20: WP Q control module, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<p>The reactive power controller can control power factor, reactive power, or voltage <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>. Reactive power capability limitations are taken into account through the limitations in the WT model (Q limitation module).</p>
<div id="tbl-parametersWPQ" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,44,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parametersWPQ-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;38: Parameters of WP Q control, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span>
</figcaption>
<div aria-describedby="tbl-parametersWPQ-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 44%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">typical value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}x_\mathrm{refmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu/s</td>
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{base}\)</span></td>
<td style="text-align: left;">Positive ramp rate limit of reference value</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathrm{d}x_\mathrm{refmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu/s</td>
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{base}\)</span></td>
<td style="text-align: left;">Negative ramp rate limit of reference value</td>
<td style="text-align: left;">-1</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{IWPx}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">1/s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">PI controller integrator gain</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{PWPx}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">PI controller proportional gain</td>
<td style="text-align: left;">0.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{WPqref}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Gain of reactive power reference</td>
<td style="text-align: left;">0.1</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(K_\mathrm{WPqu}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Cross coupling gain of U controller</td>
<td style="text-align: left;">0.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(M_\mathrm{WPqmode}\)</span></td>
<td style="text-align: left;">integer</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Control mode (0 = reactive power reference, 1 = power factor reference, 2 = Q(U) droop, 3 = voltage reference)</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathbf{q_\mathrm{WPmax}}(p_\mathrm{WP})\)</span></td>
<td style="text-align: left;">lookup-table</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Q upper limit lookup-table</td>
<td style="text-align: left;">[0,1.5; 999,1.5]</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(\mathbf{q_\mathrm{WPmin}}(p_\mathrm{WP})\)</span></td>
<td style="text-align: left;">lookup-table</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Q lower limit lookup-table</td>
<td style="text-align: left;">[0,-1.5; 999,-1.5]</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(\mathbf{q_\mathrm{WP}}(u_\mathrm{err})\)</span></td>
<td style="text-align: left;">lookup-table</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Q(U) static lookup-table</td>
<td style="text-align: left;">[-0.06,-0.4; 0.06,0.4]</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(r_\mathrm{WPdrop}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(Z_\mathrm{base}\)</span></td>
<td style="text-align: left;">WP voltage drop resistance</td>
<td style="text-align: left;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{uqfilt}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">for Q(U) mode time constant</td>
<td style="text-align: left;">0.01</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{WPqdip}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">UVRT detection U threshold</td>
<td style="text-align: left;">0.9</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{WPqrise}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">OVRT detection U threshold</td>
<td style="text-align: left;">1.1</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{errmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{base}\)</span></td>
<td style="text-align: left;">Maximum control error</td>
<td style="text-align: left;">0.2</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{errmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{base}\)</span></td>
<td style="text-align: left;">Minimum control error</td>
<td style="text-align: left;">-0.2</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{KIWPxmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{base}\)</span></td>
<td style="text-align: left;">PI controller integrator upper limit</td>
<td style="text-align: left;">1.5</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{KIWPxmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{base}\)</span></td>
<td style="text-align: left;">PI controller integrator lower limit</td>
<td style="text-align: left;">-1.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{refmax}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{base}\)</span></td>
<td style="text-align: left;">Upper limit of reference value</td>
<td style="text-align: left;">1.3</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{refmin}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{base}\)</span></td>
<td style="text-align: left;">Lower limit of reference value</td>
<td style="text-align: left;">-1.3</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{WPdrop}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(Z_\mathrm{base}\)</span></td>
<td style="text-align: left;">WP voltage drop reactance</td>
<td style="text-align: left;">0</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<section id="variables-11" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="variables-11"><span class="header-section-number">5.2.1</span> Variables</h3>
<section id="inputs-11" class="level4" data-number="5.2.1.1">
<h4 data-number="5.2.1.1" class="anchored" data-anchor-id="inputs-11"><span class="header-section-number">5.2.1.1</span> Inputs</h4>
<div id="tbl-inputsWPQ" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-inputsWPQ-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;39: Inputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-inputsWPQ-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 19%">
<col style="width: 38%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(p_\mathrm{WPfiltCom}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Measured active power</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(q_\mathrm{WPfiltCom}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(S_\mathrm{base}\)</span></td>
<td style="text-align: left;">Measured reactive power</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(u_\mathrm{WPfiltCom}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(U_\mathrm{base}\)</span></td>
<td style="text-align: left;">Measured voltage</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{WPrefCom}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{base}\)</span></td>
<td style="text-align: left;">voltage or reactive power reference</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outputs-11" class="level4" data-number="5.2.1.2">
<h4 data-number="5.2.1.2" class="anchored" data-anchor-id="outputs-11"><span class="header-section-number">5.2.1.2</span> Outputs</h4>
<div id="tbl-outputsWPQ" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outputsWPQ-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;40: Outputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-outputsWPQ-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 18%">
<col style="width: 7%">
<col style="width: 4%">
<col style="width: 17%">
<col style="width: 53%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(F_\mathrm{WPFRT}\)</span></td>
<td style="text-align: left;">boolean</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">WP FRT signal</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{PDref}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">pu</td>
<td style="text-align: left;"><span class="math inline">\(x_\mathrm{base}\)</span></td>
<td style="text-align: left;">PD voltage or reactive power reference</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
<section id="initial-equations-7" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="initial-equations-7"><span class="header-section-number">5.2.2</span> Initial equations</h3>
<p>For the used initialization helper variables, see <a href="#sec-initHelpersGlobal" class="quarto-xref">Section&nbsp;7</a>.</p>
<p><span id="eq-initXuqfilt"><span class="math display">\[
x_\mathrm{uqfilt} = Q_0
\tag{33}\]</span></span></p>
<p><span id="eq-initXwpiq"><span class="math display">\[
x_\mathrm{WPIq} = \frac{Q_\mathrm{ord\,0}}{U_0} - Q_0 \cdot K_\mathrm{WPqref}
\tag{34}\]</span></span></p>
<p><span id="eq-initXpdreframprate"><span class="math display">\[
x_\mathrm{PDrefRamprate} = \frac{Q_\mathrm{ord\,0}}{U_0}
\tag{35}\]</span></span></p>
</section>
</section>
<section id="linear-communication-delay-module" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="linear-communication-delay-module"><span class="header-section-number">5.3</span> Linear communication delay module</h2>
<div id="fig-wpCommunication" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-wpCommunication-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="drawings/WP_Communication.drawio.svg" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-wpCommunication-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;21: Linear communication delay module, example with 3 delayed variables, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
</figure>
</div>
<section id="parameters-9" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="parameters-9"><span class="header-section-number">5.3.1</span> Parameters</h3>
<div id="tbl-parametersLinearCommunictation" class="quarto-float quarto-figure quarto-figure-center anchored" data-tbl-colwidths="[6,6,5,20,44,7]">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parametersLinearCommunictation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;41: Parameters of linear communication module, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span> and <span class="citation" data-cites="digsilent2024"><a href="#ref-digsilent2024" role="doc-biblioref">[7]</a></span>
</figcaption>
<div aria-describedby="tbl-parametersLinearCommunictation-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 20%">
<col style="width: 44%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
<th style="text-align: left;">typical value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{lag}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Lag time constant</td>
<td style="text-align: left;">0.005</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline">\(T_\mathrm{lead}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">s</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">Lead time constant</td>
<td style="text-align: left;">0.005</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="variables-12" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="variables-12"><span class="header-section-number">5.3.2</span> Variables</h3>
<section id="inputs-12" class="level4" data-number="5.3.2.1">
<h4 data-number="5.3.2.1" class="anchored" data-anchor-id="inputs-12"><span class="header-section-number">5.3.2.1</span> Inputs</h4>
<div id="tbl-inputsLinearCommunication" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-inputsLinearCommunication-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;42: Inputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-inputsLinearCommunication-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 49%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(y_\mathrm{1}\dots y_\mathrm{n}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">any</td>
<td style="text-align: left;">any</td>
<td style="text-align: left;">number of inputs = n</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="outputs-12" class="level4" data-number="5.3.2.2">
<h4 data-number="5.3.2.2" class="anchored" data-anchor-id="outputs-12"><span class="header-section-number">5.3.2.2</span> Outputs</h4>
<div id="tbl-outputsLinearCommunication" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-outputsLinearCommunication-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;43: Outputs, based on <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>
</figcaption>
<div aria-describedby="tbl-outputsLinearCommunication-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 52%">
<col style="width: 6%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">name</th>
<th style="text-align: left;">type</th>
<th style="text-align: left;">unit</th>
<th style="text-align: left;">base</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline">\(y_\mathrm{1Com}\dots y_\mathrm{nCom}\)</span></td>
<td style="text-align: left;">float</td>
<td style="text-align: left;">any</td>
<td style="text-align: left;">any</td>
<td style="text-align: left;">number of outputs = n</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
</section>
</section>
</section>
<section id="sec-baseValues" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Base values</h1>
<p>The following base values are defined according to <span class="citation" data-cites="iec2020"><a href="#ref-iec2020" role="doc-biblioref">[1]</a></span>:</p>
<p><span id="eq-sBase"><span class="math display">\[
S_\mathrm{base} =
\begin{cases}
P_\mathrm{WT\,n} &amp;\mbox{(wind turbine nominal power) if referring to the wind turbine}\\
S_\mathrm{AUX\,n} &amp;\mbox{(auxiliary nominal power) if referring to auxiliary components}\\
P_\mathrm{WP\,n} &amp;\mbox{(plant nominal power) if referring to the wind power plant}
\end{cases}
\tag{36}\]</span></span></p>
<p><span id="eq-uBase"><span class="math display">\[
U_\mathrm{base} =
\begin{cases}
U_\mathrm{WT\,n} &amp;\mbox{(wind turbine nominal voltage) if referring to the wind turbine}\\
U_\mathrm{AUX\,n} &amp;\mbox{(auxiliary nominal voltage) if referring to auxiliary components}\\
U_\mathrm{WP\,n} &amp;\mbox{(plant nominal voltage) if referring to the wind power plant}
\end{cases}
\tag{37}\]</span></span></p>
<p><span id="eq-iBase"><span class="math display">\[
I_\mathrm{base} = \dfrac{S_\mathrm{base}}{\sqrt{3}U_\mathrm{base}}
\tag{38}\]</span></span></p>
<p><span id="eq-zBase"><span class="math display">\[
Z_\mathrm{base} = \dfrac{U_\mathrm{base}^2}{S_\mathrm{base}}
\tag{39}\]</span></span></p>
<p><span id="eq-omegaBase"><span class="math display">\[
\Omega_\mathrm{base} =
\begin{cases}
\omega_\mathrm{n} &amp;\mbox{if referring to generator}\\
\dfrac{\omega_\mathrm{n}}{n_\mathrm{gearbox}} &amp; \mbox{if referring to wind turbine rotor}
\end{cases}
\tag{40}\]</span></span></p>
<p><span id="eq-tBase"><span class="math display">\[
T_\mathrm{base} = \dfrac{P_\mathrm{WT\,n}}{\Omega_\mathrm{base}} \mbox{ (use turbine nominal power)}
\tag{41}\]</span></span></p>
<p><span id="eq-xBase"><span class="math display">\[
x_\mathrm{base} =
\begin{cases}
S_\mathrm{base} &amp;\mbox{if in reactive power control mode}\\
U_\mathrm{base} &amp;\mbox{if in voltage control mode}
\end{cases}
\tag{42}\]</span></span></p>
</section>
<section id="sec-initHelpersGlobal" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Operating point and initialization helpers</h1>
<table class="caption-top table">
<caption>Initial operating point parameters</caption>
<thead>
<tr class="header">
<th>Operating point parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(P_\mathrm{0}\)</span></td>
<td>Active power at point of connection</td>
</tr>
<tr class="even">
<td><span class="math inline">\(U_\mathrm{0}\)</span></td>
<td>Voltage magnitude at point of connection</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\varphi_\mathrm{0}\)</span></td>
<td>Voltage angle at point of connection</td>
</tr>
<tr class="even">
<td><span class="math inline">\(Q_\mathrm{0}\)</span></td>
<td>Reactive power at point of connection</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\omega_0\)</span></td>
<td>Grid frequency (typically 1 pu)</td>
</tr>
<tr class="even">
<td><span class="math inline">\(P_\mathrm{WTRef\,0}\)</span></td>
<td>Active power setpoint</td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\underline{Z}\)</span></td>
<td>Connection impedance</td>
</tr>
<tr class="even">
<td><span class="math inline">\(\underline{Y}\)</span></td>
<td>Connection admittance</td>
</tr>
</tbody>
</table>
<p><span id="eq-u0"><span class="math display">\[
\underline{u}_0 =  U_0 \exp (\mathrm{j}\varphi_\mathrm{0})
\tag{43}\]</span></span></p>
<p><span id="eq-i0"><span class="math display">\[
\underline{i}_0 =  ((P_0 + \mathrm{j}Q_0)/\underline{u}_0)^*
\tag{44}\]</span></span></p>
<p><span id="eq-ugs0"><span class="math display">\[
U_\mathrm{gs\,re\,0} + \mathrm{j}U_\mathrm{gs\,im\,0} = \underline{u}_\mathrm{gs\,0} = \underline{u}_0 - \underline{Z} \cdot \underline{i}_0
\tag{45}\]</span></span></p>
<p><span id="eq-igs0"><span class="math display">\[
I_\mathrm{gs\,re\,0} + \mathrm{j}I_\mathrm{gs\,im\,0} = \underline{i}_\mathrm{gs\,0} = \underline{i}_0 - \underline{Y} \cdot \underline{u}_\mathrm{gs\,0}
\tag{46}\]</span></span></p>
<p><span id="eq-initPOrd"><span class="math display">\[
P_\mathrm{ord\,0} =
\begin{cases}
    P_\mathrm{0} &amp; \text{for Type 3A}\\
    U_\mathrm{0} \cdot ((I_\mathrm{gs\,re\,0} + \frac{U_\mathrm{gs\,im\,0}}{X_\mathrm{eqv}})\cos(\varphi_\mathrm{u\,0}) + (I_\mathrm{gs\,im\,0} - \frac{U_\mathrm{gs\,re\,0}}{X_\mathrm{eqv}})\sin(\varphi_\mathrm{u\,0})) &amp; \text{for Type 3B}
\end{cases}
\tag{47}\]</span></span></p>
<p><span id="eq-initQOrd"><span class="math display">\[
Q_\mathrm{ord\,0} =
\begin{cases}
    Q_\mathrm{0} &amp; \text{for Type 3A}\\
    -U_\mathrm{0} \cdot ((I_\mathrm{gs\,re\,0} + \frac{U_\mathrm{gs\,im\,0}}{X_\mathrm{eqv}})\sin(\varphi_\mathrm{u\,0}) - (I_\mathrm{gs\,im\,0} - \frac{U_\mathrm{gs\,re\,0}}{X_\mathrm{eqv}})\cos(\varphi_\mathrm{u\,0}) &amp;~\\
    + \frac{\sqrt{U_\mathrm{gs\,re\,0}^2+U_\mathrm{gs\,im\,0}^2}}{X_\mathrm{eqv}}) &amp; \text{for Type 3B}
\end{cases}
\tag{48}\]</span></span></p>
<p><span id="eq-initPAg"><span class="math display">\[
P_\mathrm{ag\,0} = \Re \left( (U_\mathrm{gs\,re\,0}+ \mathrm{j}U_\mathrm{gs\,im\,0}) \cdot (I_\mathrm{gs\,re\,0}- \mathrm{j}I_\mathrm{gs\,im\,0}) \right)
\tag{49}\]</span></span></p>
</section>
<section id="open-questions" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Open questions</h1>
<ul>
<li>It remained unclear to the authors what the torque PI input <span class="math inline">\(u_\mathrm{TChook}\)</span> represents in the P Controller.</li>
</ul>
</section>
<section id="information-about-dynawo-implementation-modelica" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Information about Dynawo implementation (modelica)</h1>
<section id="available-models" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="available-models"><span class="header-section-number">9.1</span> Available models</h2>
<div id="tbl-availability_in_dynawo" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-availability_in_dynawo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;44: Necessary sub models and their availability in Dynawo
</figcaption>
<div aria-describedby="tbl-availability_in_dynawo-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 34%">
<col style="width: 65%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Sub model</th>
<th style="text-align: left;">Name in Dynawo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">WT Pitch angle control module</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .IEC61400 .BaseControls .WT .PitchAngleControl</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT Two-dimensional aerodynamic module</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .IEC61400 .BaseControls .WT .Aerodynamic2d</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT Two mass mechanical module</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .BaseControls .WT .Mechanical</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT Grid measurement module</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .BaseControls .Auxiliaries .Measurements</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT Generator control sub-structure (Type 3)</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .IEC61400 .WT .Control3AB2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT P control module (Type 3)</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .IEC61400 .BaseControls .WT .PControl3AB2020</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT Torque PI block (Type 3)</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .IEC61400 .BaseControls .WT .TorquePi</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT Q control module</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .BaseControls .WT .QControl2020</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT Current limitation module</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .BaseControls .WT .CurrentLimiter2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT Q limitation module</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .BaseControls .WT .QLimiter2020</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT Generator system Type 3A</td>
<td style="text-align: left;">Dynawo .Electrical .Sources .IEC .BaseConverters .GenSystem3a</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT Generator system Type 3B</td>
<td style="text-align: left;">Dynawo .Electrical .Sources .IEC .BaseConverters .GenSystem3b</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WT Grid protection system module</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .BaseControls .Auxiliaries .GridProtection2020</td>
</tr>
<tr class="even">
<td style="text-align: left;">WT Electrical system</td>
<td style="text-align: left;">Dynawo .Electrical .Sources .IEC .BaseConverters .ElecSystem</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WP control and communication module</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .WPP .WPPControl</td>
</tr>
<tr class="even">
<td style="text-align: left;">WP P control</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .BaseControls .WPP .QControl</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WP Q control</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .BaseControls .WPP .PControl</td>
</tr>
<tr class="even">
<td style="text-align: left;">Linear communication module</td>
<td style="text-align: left;">Dynawo .Electrical .Controls .IEC .BaseControls .WPP .LinearCommunication</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Communication delay module</td>
<td style="text-align: left;">- (in development by RTE)</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="torque-pi-block-type-3" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="torque-pi-block-type-3"><span class="header-section-number">9.2</span> Torque PI block (Type 3)</h2>
<ul>
<li>the rate limiter that limits <span class="math inline">\(\tau_\mathrm{reset}\)</span> in <a href="#fig-torquePi" class="quarto-xref">Figure&nbsp;5</a> is implemented using a fast first-order lag. Its time constant needs to be very fast. Otherwise, the set function does not behave as desired.</li>
</ul>
</section>
<section id="pitch-angle-control-block" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="pitch-angle-control-block"><span class="header-section-number">9.3</span> Pitch angle control block</h2>
<p>While the IEC standard defines integrator gain parameters for the speed and power integrators, the dynamics of the anti-windup integrators in Dynawo are defined by the integration time constant. If the integration time constant is set to be <span class="math inline">\(1/K_\mathrm{I}\)</span>, the gain value cannot be zero. Therefore, the typical value of <span class="math inline">\(K_\mathrm{Ic}\)</span> needs to be changed to a very small number (e.g.&nbsp;1e-9) instead of zero.</p>
</section>
</section>
<section id="table-of-references" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Table of references</h1>
<div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-iec2020" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline"><span>“<span>IEC</span> 61400-27-1 <span>Wind Energy Generation Systems</span> – <span>Part27</span> – <span>Electrical</span> simulation models – <span>Generic</span> models.”</span> Jul. 2020.</div>
</div>
<div id="ref-honrubia-escribano2018" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">A. Honrubia-Escribano, E. Gómez-Lázaro, J. Fortmann, P. Sørensen, and S. Martin-Martinez, <span>“Generic dynamic wind turbine models for power system stability analysis: <span>A</span> comprehensive review,”</span> <em>Renewable and Sustainable Energy Reviews</em>, vol. 81, pp. 1939–1952, Jan. 2018, doi: <a href="https://doi.org/10.1016/j.rser.2017.06.005">10.1016/j.rser.2017.06.005</a>.</div>
</div>
<div id="ref-fortmann2014" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">J. Fortmann, <em>Modeling of wind turbines with doubly fed generator system</em>. Wiesbaden: Springer Vieweg, 2014. doi: <a href="https://doi.org/10.1007/978-3-658-06882-0">10.1007/978-3-658-06882-0</a>.</div>
</div>
<div id="ref-fortmann2014a" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline">J. Fortmann, S. Engelhardt, J. Kretschmann, C. Feltes, and I. Erlich, <span>“New <span>Generic Model</span> of <span>DFG-Based Wind Turbines</span> for <span>RMS-Type Simulation</span>,”</span> <em>IEEE Transactions on Energy Conversion</em>, vol. 29, no. 1, pp. 110–118, Mar. 2014, doi: <a href="https://doi.org/10.1109/TEC.2013.2287251">10.1109/TEC.2013.2287251</a>.</div>
</div>
<div id="ref-lorenzo-bonache2017" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div><div class="csl-right-inline">A. Lorenzo-Bonache, A. Honrubia-Escribano, F. Jiménez-Buendía, Á. Molina-García, and E. Gómez-Lázaro, <span>“Generic <span>Type</span> 3 <span>Wind Turbine Model Based</span> on <span>IEC</span> 61400-27-1: <span>Parameter Analysis</span> and <span>Transient Response</span> under <span>Voltage Dips</span>,”</span> <em>Energies</em>, vol. 10, no. 9, 9, p. 1441, Sep. 2017, doi: <a href="https://doi.org/10.3390/en10091441">10.3390/en10091441</a>.</div>
</div>
<div id="ref-lorenzo-bonache2019" class="csl-entry" role="listitem">
<div class="csl-left-margin">[6] </div><div class="csl-right-inline">A. Lorenzo-Bonache, A. Honrubia-Escribano, J. Fortmann, and E. Gómez-Lázaro, <span>“Generic <span>Type</span> 3 <span>WT</span> models: Comparison between <span>IEC</span> and <span>WECC</span> approaches,”</span> <em>IET Renewable Power Generation</em>, vol. 13, no. 7, pp. 1168–1178, 2019, doi: <a href="https://doi.org/10.1049/iet-rpg.2018.6098">10.1049/iet-rpg.2018.6098</a>.</div>
</div>
<div id="ref-digsilent2024" class="csl-entry" role="listitem">
<div class="csl-left-margin">[7] </div><div class="csl-right-inline">DIgSILENT, <span>“<span>PowerFactory</span>.”</span> 2024. Available: <a href="https://www.digsilent.de/">https://www.digsilent.de/</a></div>
</div>
<div id="ref-franke2024" class="csl-entry" role="listitem">
<div class="csl-left-margin">[8] </div><div class="csl-right-inline">M. Franke, A. Guironnet, and C. Cardozo, <span>“Comparing <span>IEC</span> and <span>WECC Generic Dynamic Models</span> for <span>Type</span> 4 <span>Wind Turbines</span>,”</span> 2024.</div>
</div>
<div id="ref-tsourakis2009" class="csl-entry" role="listitem">
<div class="csl-left-margin">[9] </div><div class="csl-right-inline">G. Tsourakis, B. M. Nomikos, and C. D. Vournas, <span>“Contribution of <span>Doubly Fed Wind Generators</span> to <span>Oscillation Damping</span>,”</span> <em>IEEE Trans. Energy Convers.</em>, vol. 24, no. 3, pp. 783–791, Sep. 2009, doi: <a href="https://doi.org/10.1109/TEC.2009.2025330">10.1109/TEC.2009.2025330</a>.</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>